<!-- livebook:{"persist_outputs":true} -->

# Makemore: Elixir

```elixir
Mix.install([
  {:nx, "~> 0.10.0"},
  {:tucan, "~> 0.5.1"},
  {:kino_vega_lite, "~> 0.1.13"},
  {:exla, "~> 0.10.0"}
])
```

## Introduction

Now that we have an understanding over how a neural network functions we can start learning how to work with text and working our way towards understanding transformers.

```elixir
names =
  File.read!(__DIR__ <> "/data/names.txt")
  |> String.split("\n")
```

<!-- livebook:{"output":true} -->

```
["emma", "olivia", "ava", "isabella", "sophia", "charlotte", "mia", "amelia", "harper", "evelyn",
 "abigail", "emily", "elizabeth", "mila", "ella", "avery", "sofia", "camila", "aria", "scarlett",
 "victoria", "madison", "luna", "grace", "chloe", "penelope", "layla", "riley", "zoey", "nora",
 "lily", "eleanor", "hannah", "lillian", "addison", "aubrey", "ellie", "stella", "natalie", "zoe",
 "leah", "hazel", "violet", "aurora", "savannah", "audrey", "brooklyn", "bella", "claire", "skylar",
 ...]
```

```elixir
IO.write("""
#{length(names)} examples in dataset
shortest name: #{Enum.min_by(names, &String.length/1) |> String.length()}
longest name: #{Enum.max_by(names, &String.length/1) |> String.length()}
""")
```

<!-- livebook:{"output":true} -->

```
32033 examples in dataset
shortest name: 2
longest name: 15
```

<!-- livebook:{"output":true} -->

```
:ok
```

Our goal is to create a system that can predict the next token (or single character) when given some text as input. We'll start with simple models and slowly build them up to a transformer and then onto GPT and nanochat.

1. Simple bigram model
2. MLP bigram
3. TBC

## Simple bigram model

To begin with we can build a statistical model based on the liklihood of a character coming next. We can break up the list of names that we've imported into pairs of characters, showing which character we start with, and which character then followed.

So for example `anna` would become:

```
['.', 'a'],
['a', 'n'],
['n', 'n'],
['n', 'a'],
['a', '.']
```

The `.` character signifies either the beginning or end of the word.

This gives us five bigrams from the one word. If we go through every word in the dataset and break them down into the bigrams from start to finish we can the count up the number of times we see each of the bigrams appear.

```elixir
defmodule Bigram do
  def from_string(str) do
    "." <> str <> "."
    |> String.split("", trim: true)
    |> Enum.chunk_every(2, 1, :discard)  
  end
end

bigram_count =
  names
  |> Enum.flat_map(&Bigram.from_string/1)
  |> Enum.reduce(%{}, fn bigram, acc -> Map.update(acc, bigram, 1, & &1 + 1) end)

IO.write("Number of unique bigrams: #{Map.to_list(bigram_count) |> length()}")

Enum.sort_by(bigram_count, &elem(&1, 1), :desc)
```

<!-- livebook:{"output":true} -->

```
Number of unique bigrams: 627
```

<!-- livebook:{"output":true} -->

```
[
  {["n", "."], 6763},
  {["a", "."], 6640},
  {["a", "n"], 5438},
  {[".", "a"], 4410},
  {["e", "."], 3983},
  {["a", "r"], 3264},
  {["e", "l"], 3248},
  {["r", "i"], 3033},
  {["n", "a"], 2977},
  {[".", "k"], 2963},
  {["l", "e"], 2921},
  {["e", "n"], 2675},
  {["l", "a"], 2623},
  {["m", "a"], 2590},
  {[".", "m"], 2538},
  {["a", "l"], 2528},
  {["i", "."], 2489},
  {["l", "i"], 2480},
  {["i", "a"], 2445},
  {[".", "j"], 2422},
  {["o", "n"], 2411},
  {["h", "."], 2409},
  {["r", "a"], 2356},
  {["a", "h"], 2332},
  {["h", "a"], 2244},
  {["y", "a"], 2143},
  {["i", "n"], 2126},
  {[".", "s"], 2055},
  {["a", "y"], 2050},
  {["y", "."], 2007},
  {["e", "r"], 1958},
  {["n", "n"], 1906},
  {["y", "n"], 1826},
  {["k", "a"], 1731},
  {["n", "i"], 1725},
  {["r", "e"], 1697},
  {[".", "d"], 1690},
  {["i", "e"], 1653},
  {["a", "i"], 1650},
  {[".", "r"], 1639},
  {["a", "m"], 1634},
  {["l", "y"], 1588},
  {[".", "l"], 1572},
  {[".", "c"], 1542},
  {[".", "e"], 1531},
  {["j", "a"], 1473},
  {["r", "."], 1377},
  {["n", ...], 1359},
  {[...], ...},
  {...},
  ...
]
```

We can quickly see that it's very likely for a word to end with `n` or `a`, and the bigram `[a, n]` is very likely to appear somewhere within the words.

We can visualise all of the possible bigrams and what is most common using a heatmap built with `Tucan`.

```elixir
chars =
  Enum.concat([?.], ?a..?z)
  |> List.to_string
  |> String.graphemes()

for x <- chars, y <- chars do  
  %{
    "first_character" => x,
    "second_character" => y,
    "occurrence_count" => bigram_count[[x, y]] || 0
  }
end
|> Tucan.heatmap(
  "second_character",
  "first_character",
  "occurrence_count",
  annotate: true,
  tooltip: true,
  aggregate: :sum,
  color: [legend: false],
  x: [axis: [orient: :top, label_angle: 0]]
)
|> Tucan.set_theme(:power_bi)
|> Tucan.set_width(800)
```

<!-- livebook:{"output":true} -->

```vega-lite
{"$schema":"https://vega.github.io/schema/vega-lite/v5.json","__tucan__":{"multilayer":true,"types":{"first_character":"nominal","occurrence_count":"quantitative","second_character":"nominal"}},"config":{"arc":{"fill":"#118DFF"},"area":{"fill":"#118DFF","line":true,"opacity":0.6},"axis":{"domain":false,"grid":false,"labelColor":"#605E5C","labelFontSize":12.0,"ticks":false,"titleColor":"#252423","titleFont":"wf_standard-font, helvetica, arial, sans-serif","titleFontSize":16.0,"titleFontWeight":"normal"},"axisBand":{"tickExtra":true},"axisQuantitative":{"grid":true,"gridColor":"#c8C6C4","gridDash":[1,5],"labelFlush":false,"tickCount":3},"axisX":{"labelPadding":5},"axisY":{"labelPadding":10},"background":"transparent","bar":{"fill":"#118DFF"},"font":"segoe uI","header":{"labelColor":"#605E5C","labelFont":"segoe uI","labelFontSize":13.333333333333332,"titleColor":"#252423","titleFont":"wf_standard-font, helvetica, arial, sans-serif","titleFontSize":16.0},"legend":{"labelColor":"#605E5C","labelFont":"segoe uI","labelFontSize":13.333333333333332,"symbolSize":75,"symbolType":"circle","titleColor":"#605E5C","titleFont":"segoe uI","titleFontWeight":"bold"},"line":{"stroke":"#118DFF","strokeCap":"round","strokeJoin":"round","strokeWidth":3},"path":{"stroke":"#118DFF"},"point":{"fill":"#118DFF","filled":true,"size":75},"range":{"category":["#118DFF","#12239E","#e66C37","#6B007B","#e044A7","#744EC2","#d9B300","#d64550"],"diverging":["#dEEFFF","#118DFF"],"heatmap":["#dEEFFF","#118DFF"],"ordinal":["#dEEFFF","#c7e4ff","#b0d9ff","#9aceff","#83c3ff","#6cb9ff","#55aeff","#3fa3ff","#2898ff","#118DFF"]},"rect":{"fill":"#118DFF"},"shape":{"stroke":"#118DFF"},"symbol":{"fill":"#118DFF","size":50,"strokeWidth":1.5},"text":{"fill":"#605E5C","font":"segoe uI","fontSize":12.0},"view":{"stroke":"transparent"}},"data":{"values":[{"first_character":".","occurrence_count":0,"second_character":"."},{"first_character":".","occurrence_count":4410,"second_character":"a"},{"first_character":".","occurrence_count":1306,"second_character":"b"},{"first_character":".","occurrence_count":1542,"second_character":"c"},{"first_character":".","occurrence_count":1690,"second_character":"d"},{"first_character":".","occurrence_count":1531,"second_character":"e"},{"first_character":".","occurrence_count":417,"second_character":"f"},{"first_character":".","occurrence_count":669,"second_character":"g"},{"first_character":".","occurrence_count":874,"second_character":"h"},{"first_character":".","occurrence_count":591,"second_character":"i"},{"first_character":".","occurrence_count":2422,"second_character":"j"},{"first_character":".","occurrence_count":2963,"second_character":"k"},{"first_character":".","occurrence_count":1572,"second_character":"l"},{"first_character":".","occurrence_count":2538,"second_character":"m"},{"first_character":".","occurrence_count":1146,"second_character":"n"},{"first_character":".","occurrence_count":394,"second_character":"o"},{"first_character":".","occurrence_count":515,"second_character":"p"},{"first_character":".","occurrence_count":92,"second_character":"q"},{"first_character":".","occurrence_count":1639,"second_character":"r"},{"first_character":".","occurrence_count":2055,"second_character":"s"},{"first_character":".","occurrence_count":1308,"second_character":"t"},{"first_character":".","occurrence_count":78,"second_character":"u"},{"first_character":".","occurrence_count":376,"second_character":"v"},{"first_character":".","occurrence_count":307,"second_character":"w"},{"first_character":".","occurrence_count":134,"second_character":"x"},{"first_character":".","occurrence_count":535,"second_character":"y"},{"first_character":".","occurrence_count":929,"second_character":"z"},{"first_character":"a","occurrence_count":6640,"second_character":"."},{"first_character":"a","occurrence_count":556,"second_character":"a"},{"first_character":"a","occurrence_count":541,"second_character":"b"},{"first_character":"a","occurrence_count":470,"second_character":"c"},{"first_character":"a","occurrence_count":1042,"second_character":"d"},{"first_character":"a","occurrence_count":692,"second_character":"e"},{"first_character":"a","occurrence_count":134,"second_character":"f"},{"first_character":"a","occurrence_count":168,"second_character":"g"},{"first_character":"a","occurrence_count":2332,"second_character":"h"},{"first_character":"a","occurrence_count":1650,"second_character":"i"},{"first_character":"a","occurrence_count":175,"second_character":"j"},{"first_character":"a","occurrence_count":568,"second_character":"k"},{"first_character":"a","occurrence_count":2528,"second_character":"l"},{"first_character":"a","occurrence_count":1634,"second_character":"m"},{"first_character":"a","occurrence_count":5438,"second_character":"n"},{"first_character":"a","occurrence_count":63,"second_character":"o"},{"first_character":"a","occurrence_count":82,"second_character":"p"},{"first_character":"a","occurrence_count":60,"second_character":"q"},{"first_character":"a","occurrence_count":3264,"second_character":"r"},{"first_character":"a","occurrence_count":1118,"second_character":"s"},{"first_character":"a","occurrence_count":687,"second_character":"t"},{"first_character":"a","occurrence_count":381,"second_character":"u"},{"first_character":"a","occurrence_count":834,"second_character":"v"},{"first_character":"a","occurrence_count":161,"second_character":"w"},{"first_character":"a","occurrence_count":182,"second_character":"x"},{"first_character":"a","occurrence_count":2050,"second_character":"y"},{"first_character":"a","occurrence_count":435,"second_character":"z"},{"first_character":"b","occurrence_count":114,"second_character":"."},{"first_character":"b","occurrence_count":321,"second_character":"a"},{"first_character":"b","occurrence_count":38,"second_character":"b"},{"first_character":"b","occurrence_count":1,"second_character":"c"},{"first_character":"b","occurrence_count":65,"second_character":"d"},{"first_character":"b","occurrence_count":655,"second_character":"e"},{"first_character":"b","occurrence_count":0,"second_character":"f"},{"first_character":"b","occurrence_count":0,"second_character":"g"},{"first_character":"b","occurrence_count":41,"second_character":"h"},{"first_character":"b","occurrence_count":217,"second_character":"i"},{"first_character":"b","occurrence_count":1,"second_character":"j"},{"first_character":"b","occurrence_count":0,"second_character":"k"},{"first_character":"b","occurrence_count":103,"second_character":"l"},{"first_character":"b","occurrence_count":0,"second_character":"m"},{"first_character":"b","occurrence_count":4,"second_character":"n"},{"first_character":"b","occurrence_count":105,"second_character":"o"},{"first_character":"b","occurrence_count":0,"second_character":"p"},{"first_character":"b","occurrence_count":0,"second_character":"q"},{"first_character":"b","occurrence_count":842,"second_character":"r"},{"first_character":"b","occurrence_count":8,"second_character":"s"},{"first_character":"b","occurrence_count":2,"second_character":"t"},{"first_character":"b","occurrence_count":45,"second_character":"u"},{"first_character":"b","occurrence_count":0,"second_character":"v"},{"first_character":"b","occurrence_count":0,"second_character":"w"},{"first_character":"b","occurrence_count":0,"second_character":"x"},{"first_character":"b","occurrence_count":83,"second_character":"y"},{"first_character":"b","occurrence_count":0,"second_character":"z"},{"first_character":"c","occurrence_count":97,"second_character":"."},{"first_character":"c","occurrence_count":815,"second_character":"a"},{"first_character":"c","occurrence_count":0,"second_character":"b"},{"first_character":"c","occurrence_count":42,"second_character":"c"},{"first_character":"c","occurrence_count":1,"second_character":"d"},{"first_character":"c","occurrence_count":551,"second_character":"e"},{"first_character":"c","occurrence_count":0,"second_character":"f"},{"first_character":"c","occurrence_count":2,"second_character":"g"},{"first_character":"c","occurrence_count":664,"second_character":"h"},{"first_character":"c","occurrence_count":271,"second_character":"i"},{"first_character":"c","occurrence_count":3,"second_character":"j"},{"first_character":"c","occurrence_count":316,"second_character":"k"},{"first_character":"c","occurrence_count":116,"second_character":"l"},{"first_character":"c","occurrence_count":0,"second_character":"m"},{"first_character":"c","occurrence_count":0,"second_character":"n"},{"first_character":"c","occurrence_count":380,"second_character":"o"},{"first_character":"c","occurrence_count":1,"second_character":"p"},{"first_character":"c","occurrence_count":11,"second_character":"q"},{"first_character":"c","occurrence_count":76,"second_character":"r"},{"first_character":"c","occurrence_count":5,"second_character":"s"},{"first_character":"c","occurrence_count":35,"second_character":"t"},{"first_character":"c","occurrence_count":35,"second_character":"u"},{"first_character":"c","occurrence_count":0,"second_character":"v"},{"first_character":"c","occurrence_count":0,"second_character":"w"},{"first_character":"c","occurrence_count":3,"second_character":"x"},{"first_character":"c","occurrence_count":104,"second_character":"y"},{"first_character":"c","occurrence_count":4,"second_character":"z"},{"first_character":"d","occurrence_count":516,"second_character":"."},{"first_character":"d","occurrence_count":1303,"second_character":"a"},{"first_character":"d","occurrence_count":1,"second_character":"b"},{"first_character":"d","occurrence_count":3,"second_character":"c"},{"first_character":"d","occurrence_count":149,"second_character":"d"},{"first_character":"d","occurrence_count":1283,"second_character":"e"},{"first_character":"d","occurrence_count":5,"second_character":"f"},{"first_character":"d","occurrence_count":25,"second_character":"g"},{"first_character":"d","occurrence_count":118,"second_character":"h"},{"first_character":"d","occurrence_count":674,"second_character":"i"},{"first_character":"d","occurrence_count":9,"second_character":"j"},{"first_character":"d","occurrence_count":3,"second_character":"k"},{"first_character":"d","occurrence_count":60,"second_character":"l"},{"first_character":"d","occurrence_count":30,"second_character":"m"},{"first_character":"d","occurrence_count":31,"second_character":"n"},{"first_character":"d","occurrence_count":378,"second_character":"o"},{"first_character":"d","occurrence_count":0,"second_character":"p"},{"first_character":"d","occurrence_count":1,"second_character":"q"},{"first_character":"d","occurrence_count":424,"second_character":"r"},{"first_character":"d","occurrence_count":29,"second_character":"s"},{"first_character":"d","occurrence_count":4,"second_character":"t"},{"first_character":"d","occurrence_count":92,"second_character":"u"},{"first_character":"d","occurrence_count":17,"second_character":"v"},{"first_character":"d","occurrence_count":23,"second_character":"w"},{"first_character":"d","occurrence_count":0,"second_character":"x"},{"first_character":"d","occurrence_count":317,"second_character":"y"},{"first_character":"d","occurrence_count":1,"second_character":"z"},{"first_character":"e","occurrence_count":3983,"second_character":"."},{"first_character":"e","occurrence_count":679,"second_character":"a"},{"first_character":"e","occurrence_count":121,"second_character":"b"},{"first_character":"e","occurrence_count":153,"second_character":"c"},{"first_character":"e","occurrence_count":384,"second_character":"d"},{"first_character":"e","occurrence_count":1271,"second_character":"e"},{"first_character":"e","occurrence_count":82,"second_character":"f"},{"first_character":"e","occurrence_count":125,"second_character":"g"},{"first_character":"e","occurrence_count":152,"second_character":"h"},{"first_character":"e","occurrence_count":818,"second_character":"i"},{"first_character":"e","occurrence_count":55,"second_character":"j"},{"first_character":"e","occurrence_count":178,"second_character":"k"},{"first_character":"e","occurrence_count":3248,"second_character":"l"},{"first_character":"e","occurrence_count":769,"second_character":"m"},{"first_character":"e","occurrence_count":2675,"second_character":"n"},{"first_character":"e","occurrence_count":269,"second_character":"o"},{"first_character":"e","occurrence_count":83,"second_character":"p"},{"first_character":"e","occurrence_count":14,"second_character":"q"},{"first_character":"e","occurrence_count":1958,"second_character":"r"},{"first_character":"e","occurrence_count":861,"second_character":"s"},{"first_character":"e","occurrence_count":580,"second_character":"t"},{"first_character":"e","occurrence_count":69,"second_character":"u"},{"first_character":"e","occurrence_count":463,"second_character":"v"},{"first_character":"e","occurrence_count":50,"second_character":"w"},{"first_character":"e","occurrence_count":132,"second_character":"x"},{"first_character":"e","occurrence_count":1070,"second_character":"y"},{"first_character":"e","occurrence_count":181,"second_character":"z"},{"first_character":"f","occurrence_count":80,"second_character":"."},{"first_character":"f","occurrence_count":242,"second_character":"a"},{"first_character":"f","occurrence_count":0,"second_character":"b"},{"first_character":"f","occurrence_count":0,"second_character":"c"},{"first_character":"f","occurrence_count":0,"second_character":"d"},{"first_character":"f","occurrence_count":123,"second_character":"e"},{"first_character":"f","occurrence_count":44,"second_character":"f"},{"first_character":"f","occurrence_count":1,"second_character":"g"},{"first_character":"f","occurrence_count":1,"second_character":"h"},{"first_character":"f","occurrence_count":160,"second_character":"i"},{"first_character":"f","occurrence_count":0,"second_character":"j"},{"first_character":"f","occurrence_count":2,"second_character":"k"},{"first_character":"f","occurrence_count":20,"second_character":"l"},{"first_character":"f","occurrence_count":0,"second_character":"m"},{"first_character":"f","occurrence_count":4,"second_character":"n"},{"first_character":"f","occurrence_count":60,"second_character":"o"},{"first_character":"f","occurrence_count":0,"second_character":"p"},{"first_character":"f","occurrence_count":0,"second_character":"q"},{"first_character":"f","occurrence_count":114,"second_character":"r"},{"first_character":"f","occurrence_count":6,"second_character":"s"},{"first_character":"f","occurrence_count":18,"second_character":"t"},{"first_character":"f","occurrence_count":10,"second_character":"u"},{"first_character":"f","occurrence_count":0,"second_character":"v"},{"first_character":"f","occurrence_count":4,"second_character":"w"},{"first_character":"f","occurrence_count":0,"second_character":"x"},{"first_character":"f","occurrence_count":14,"second_character":"y"},{"first_character":"f","occurrence_count":2,"second_character":"z"},{"first_character":"g","occurrence_count":108,"second_character":"."},{"first_character":"g","occurrence_count":330,"second_character":"a"},{"first_character":"g","occurrence_count":3,"second_character":"b"},{"first_character":"g","occurrence_count":0,"second_character":"c"},{"first_character":"g","occurrence_count":19,"second_character":"d"},{"first_character":"g","occurrence_count":334,"second_character":"e"},{"first_character":"g","occurrence_count":1,"second_character":"f"},{"first_character":"g","occurrence_count":25,"second_character":"g"},{"first_character":"g","occurrence_count":360,"second_character":"h"},{"first_character":"g","occurrence_count":190,"second_character":"i"},{"first_character":"g","occurrence_count":3,"second_character":"j"},{"first_character":"g","occurrence_count":0,"second_character":"k"},{"first_character":"g","occurrence_count":32,"second_character":"l"},{"first_character":"g","occurrence_count":6,"second_character":"m"},{"first_character":"g","occurrence_count":27,"second_character":"n"},{"first_character":"g","occurrence_count":83,"second_character":"o"},{"first_character":"g","occurrence_count":0,"second_character":"p"},{"first_character":"g","occurrence_count":0,"second_character":"q"},{"first_character":"g","occurrence_count":201,"second_character":"r"},{"first_character":"g","occurrence_count":30,"second_character":"s"},{"first_character":"g","occurrence_count":31,"second_character":"t"},{"first_character":"g","occurrence_count":85,"second_character":"u"},{"first_character":"g","occurrence_count":1,"second_character":"v"},{"first_character":"g","occurrence_count":26,"second_character":"w"},{"first_character":"g","occurrence_count":0,"second_character":"x"},{"first_character":"g","occurrence_count":31,"second_character":"y"},{"first_character":"g","occurrence_count":1,"second_character":"z"},{"first_character":"h","occurrence_count":2409,"second_character":"."},{"first_character":"h","occurrence_count":2244,"second_character":"a"},{"first_character":"h","occurrence_count":8,"second_character":"b"},{"first_character":"h","occurrence_count":2,"second_character":"c"},{"first_character":"h","occurrence_count":24,"second_character":"d"},{"first_character":"h","occurrence_count":674,"second_character":"e"},{"first_character":"h","occurrence_count":2,"second_character":"f"},{"first_character":"h","occurrence_count":2,"second_character":"g"},{"first_character":"h","occurrence_count":1,"second_character":"h"},{"first_character":"h","occurrence_count":729,"second_character":"i"},{"first_character":"h","occurrence_count":9,"second_character":"j"},{"first_character":"h","occurrence_count":29,"second_character":"k"},{"first_character":"h","occurrence_count":185,"second_character":"l"},{"first_character":"h","occurrence_count":117,"second_character":"m"},{"first_character":"h","occurrence_count":138,"second_character":"n"},{"first_character":"h","occurrence_count":287,"second_character":"o"},{"first_character":"h","occurrence_count":1,"second_character":"p"},{"first_character":"h","occurrence_count":1,"second_character":"q"},{"first_character":"h","occurrence_count":204,"second_character":"r"},{"first_character":"h","occurrence_count":31,"second_character":"s"},{"first_character":"h","occurrence_count":71,"second_character":"t"},{"first_character":"h","occurrence_count":166,"second_character":"u"},{"first_character":"h","occurrence_count":39,"second_character":"v"},{"first_character":"h","occurrence_count":10,"second_character":"w"},{"first_character":"h","occurrence_count":0,"second_character":"x"},{"first_character":"h","occurrence_count":213,"second_character":"y"},{"first_character":"h","occurrence_count":20,"second_character":"z"},{"first_character":"i","occurrence_count":2489,"second_character":"."},{"first_character":"i","occurrence_count":2445,"second_character":"a"},{"first_character":"i","occurrence_count":110,"second_character":"b"},{"first_character":"i","occurrence_count":509,"second_character":"c"},{"first_character":"i","occurrence_count":440,"second_character":"d"},{"first_character":"i","occurrence_count":1653,"second_character":"e"},{"first_character":"i","occurrence_count":101,"second_character":"f"},{"first_character":"i","occurrence_count":428,"second_character":"g"},{"first_character":"i","occurrence_count":95,"second_character":"h"},{"first_character":"i","occurrence_count":82,"second_character":"i"},{"first_character":"i","occurrence_count":76,"second_character":"j"},{"first_character":"i","occurrence_count":445,"second_character":"k"},{"first_character":"i","occurrence_count":1345,"second_character":"l"},{"first_character":"i","occurrence_count":427,"second_character":"m"},{"first_character":"i","occurrence_count":2126,"second_character":"n"},{"first_character":"i","occurrence_count":588,"second_character":"o"},{"first_character":"i","occurrence_count":53,"second_character":"p"},{"first_character":"i","occurrence_count":52,"second_character":"q"},{"first_character":"i","occurrence_count":849,"second_character":"r"},{"first_character":"i","occurrence_count":1316,"second_character":"s"},{"first_character":"i","occurrence_count":541,"second_character":"t"},{"first_character":"i","occurrence_count":109,"second_character":"u"},{"first_character":"i","occurrence_count":269,"second_character":"v"},{"first_character":"i","occurrence_count":8,"second_character":"w"},{"first_character":"i","occurrence_count":89,"second_character":"x"},{"first_character":"i","occurrence_count":779,"second_character":"y"},{"first_character":"i","occurrence_count":277,"second_character":"z"},{"first_character":"j","occurrence_count":71,"second_character":"."},{"first_character":"j","occurrence_count":1473,"second_character":"a"},{"first_character":"j","occurrence_count":1,"second_character":"b"},{"first_character":"j","occurrence_count":4,"second_character":"c"},{"first_character":"j","occurrence_count":4,"second_character":"d"},{"first_character":"j","occurrence_count":440,"second_character":"e"},{"first_character":"j","occurrence_count":0,"second_character":"f"},{"first_character":"j","occurrence_count":0,"second_character":"g"},{"first_character":"j","occurrence_count":45,"second_character":"h"},{"first_character":"j","occurrence_count":119,"second_character":"i"},{"first_character":"j","occurrence_count":2,"second_character":"j"},{"first_character":"j","occurrence_count":2,"second_character":"k"},{"first_character":"j","occurrence_count":9,"second_character":"l"},{"first_character":"j","occurrence_count":5,"second_character":"m"},{"first_character":"j","occurrence_count":2,"second_character":"n"},{"first_character":"j","occurrence_count":479,"second_character":"o"},{"first_character":"j","occurrence_count":1,"second_character":"p"},{"first_character":"j","occurrence_count":0,"second_character":"q"},{"first_character":"j","occurrence_count":11,"second_character":"r"},{"first_character":"j","occurrence_count":7,"second_character":"s"},{"first_character":"j","occurrence_count":2,"second_character":"t"},{"first_character":"j","occurrence_count":202,"second_character":"u"},{"first_character":"j","occurrence_count":5,"second_character":"v"},{"first_character":"j","occurrence_count":6,"second_character":"w"},{"first_character":"j","occurrence_count":0,"second_character":"x"},{"first_character":"j","occurrence_count":10,"second_character":"y"},{"first_character":"j","occurrence_count":0,"second_character":"z"},{"first_character":"k","occurrence_count":363,"second_character":"."},{"first_character":"k","occurrence_count":1731,"second_character":"a"},{"first_character":"k","occurrence_count":2,"second_character":"b"},{"first_character":"k","occurrence_count":2,"second_character":"c"},{"first_character":"k","occurrence_count":2,"second_character":"d"},{"first_character":"k","occurrence_count":895,"second_character":"e"},{"first_character":"k","occurrence_count":1,"second_character":"f"},{"first_character":"k","occurrence_count":0,"second_character":"g"},{"first_character":"k","occurrence_count":307,"second_character":"h"},{"first_character":"k","occurrence_count":509,"second_character":"i"},{"first_character":"k","occurrence_count":2,"second_character":"j"},{"first_character":"k","occurrence_count":20,"second_character":"k"},{"first_character":"k","occurrence_count":139,"second_character":"l"},{"first_character":"k","occurrence_count":9,"second_character":"m"},{"first_character":"k","occurrence_count":26,"second_character":"n"},{"first_character":"k","occurrence_count":344,"second_character":"o"},{"first_character":"k","occurrence_count":0,"second_character":"p"},{"first_character":"k","occurrence_count":0,"second_character":"q"},{"first_character":"k","occurrence_count":109,"second_character":"r"},{"first_character":"k","occurrence_count":95,"second_character":"s"},{"first_character":"k","occurrence_count":17,"second_character":"t"},{"first_character":"k","occurrence_count":50,"second_character":"u"},{"first_character":"k","occurrence_count":2,"second_character":"v"},{"first_character":"k","occurrence_count":34,"second_character":"w"},{"first_character":"k","occurrence_count":0,"second_character":"x"},{"first_character":"k","occurrence_count":379,"second_character":"y"},{"first_character":"k","occurrence_count":2,"second_character":"z"},{"first_character":"l","occurrence_count":1314,"second_character":"."},{"first_character":"l","occurrence_count":2623,"second_character":"a"},{"first_character":"l","occurrence_count":52,"second_character":"b"},{"first_character":"l","occurrence_count":25,"second_character":"c"},{"first_character":"l","occurrence_count":138,"second_character":"d"},{"first_character":"l","occurrence_count":2921,"second_character":"e"},{"first_character":"l","occurrence_count":22,"second_character":"f"},{"first_character":"l","occurrence_count":6,"second_character":"g"},{"first_character":"l","occurrence_count":19,"second_character":"h"},{"first_character":"l","occurrence_count":2480,"second_character":"i"},{"first_character":"l","occurrence_count":6,"second_character":"j"},{"first_character":"l","occurrence_count":24,"second_character":"k"},{"first_character":"l","occurrence_count":1345,"second_character":"l"},{"first_character":"l","occurrence_count":60,"second_character":"m"},{"first_character":"l","occurrence_count":14,"second_character":"n"},{"first_character":"l","occurrence_count":692,"second_character":"o"},{"first_character":"l","occurrence_count":15,"second_character":"p"},{"first_character":"l","occurrence_count":3,"second_character":"q"},{"first_character":"l","occurrence_count":18,"second_character":"r"},{"first_character":"l","occurrence_count":94,"second_character":"s"},{"first_character":"l","occurrence_count":77,"second_character":"t"},{"first_character":"l","occurrence_count":324,"second_character":"u"},{"first_character":"l","occurrence_count":72,"second_character":"v"},{"first_character":"l","occurrence_count":16,"second_character":"w"},{"first_character":"l","occurrence_count":0,"second_character":"x"},{"first_character":"l","occurrence_count":1588,"second_character":"y"},{"first_character":"l","occurrence_count":10,"second_character":"z"},{"first_character":"m","occurrence_count":516,"second_character":"."},{"first_character":"m","occurrence_count":2590,"second_character":"a"},{"first_character":"m","occurrence_count":112,"second_character":"b"},{"first_character":"m","occurrence_count":51,"second_character":"c"},{"first_character":"m","occurrence_count":24,"second_character":"d"},{"first_character":"m","occurrence_count":818,"second_character":"e"},{"first_character":"m","occurrence_count":1,"second_character":"f"},{"first_character":"m","occurrence_count":0,"second_character":"g"},{"first_character":"m","occurrence_count":5,"second_character":"h"},{"first_character":"m","occurrence_count":1256,"second_character":"i"},{"first_character":"m","occurrence_count":7,"second_character":"j"},{"first_character":"m","occurrence_count":1,"second_character":"k"},{"first_character":"m","occurrence_count":5,"second_character":"l"},{"first_character":"m","occurrence_count":168,"second_character":"m"},{"first_character":"m","occurrence_count":20,"second_character":"n"},{"first_character":"m","occurrence_count":452,"second_character":"o"},{"first_character":"m","occurrence_count":38,"second_character":"p"},{"first_character":"m","occurrence_count":0,"second_character":"q"},{"first_character":"m","occurrence_count":97,"second_character":"r"},{"first_character":"m","occurrence_count":35,"second_character":"s"},{"first_character":"m","occurrence_count":4,"second_character":"t"},{"first_character":"m","occurrence_count":139,"second_character":"u"},{"first_character":"m","occurrence_count":3,"second_character":"v"},{"first_character":"m","occurrence_count":2,"second_character":"w"},{"first_character":"m","occurrence_count":0,"second_character":"x"},{"first_character":"m","occurrence_count":287,"second_character":"y"},{"first_character":"m","occurrence_count":11,"second_character":"z"},{"first_character":"n","occurrence_count":6763,"second_character":"."},{"first_character":"n","occurrence_count":2977,"second_character":"a"},{"first_character":"n","occurrence_count":8,"second_character":"b"},{"first_character":"n","occurrence_count":213,"second_character":"c"},{"first_character":"n","occurrence_count":704,"second_character":"d"},{"first_character":"n","occurrence_count":1359,"second_character":"e"},{"first_character":"n","occurrence_count":11,"second_character":"f"},{"first_character":"n","occurrence_count":273,"second_character":"g"},{"first_character":"n","occurrence_count":26,"second_character":"h"},{"first_character":"n","occurrence_count":1725,"second_character":"i"},{"first_character":"n","occurrence_count":44,"second_character":"j"},{"first_character":"n","occurrence_count":58,"second_character":"k"},{"first_character":"n","occurrence_count":195,"second_character":"l"},{"first_character":"n","occurrence_count":19,"second_character":"m"},{"first_character":"n","occurrence_count":1906,"second_character":"n"},{"first_character":"n","occurrence_count":496,"second_character":"o"},{"first_character":"n","occurrence_count":5,"second_character":"p"},{"first_character":"n","occurrence_count":2,"second_character":"q"},{"first_character":"n","occurrence_count":44,"second_character":"r"},{"first_character":"n","occurrence_count":278,"second_character":"s"},{"first_character":"n","occurrence_count":443,"second_character":"t"},{"first_character":"n","occurrence_count":96,"second_character":"u"},{"first_character":"n","occurrence_count":55,"second_character":"v"},{"first_character":"n","occurrence_count":11,"second_character":"w"},{"first_character":"n","occurrence_count":6,"second_character":"x"},{"first_character":"n","occurrence_count":465,"second_character":"y"},{"first_character":"n","occurrence_count":145,"second_character":"z"},{"first_character":"o","occurrence_count":855,"second_character":"."},{"first_character":"o","occurrence_count":149,"second_character":"a"},{"first_character":"o","occurrence_count":140,"second_character":"b"},{"first_character":"o","occurrence_count":114,"second_character":"c"},{"first_character":"o","occurrence_count":190,"second_character":"d"},{"first_character":"o","occurrence_count":132,"second_character":"e"},{"first_character":"o","occurrence_count":34,"second_character":"f"},{"first_character":"o","occurrence_count":44,"second_character":"g"},{"first_character":"o","occurrence_count":171,"second_character":"h"},{"first_character":"o","occurrence_count":69,"second_character":"i"},{"first_character":"o","occurrence_count":16,"second_character":"j"},{"first_character":"o","occurrence_count":68,"second_character":"k"},{"first_character":"o","occurrence_count":619,"second_character":"l"},{"first_character":"o","occurrence_count":261,"second_character":"m"},{"first_character":"o","occurrence_count":2411,"second_character":"n"},{"first_character":"o","occurrence_count":115,"second_character":"o"},{"first_character":"o","occurrence_count":95,"second_character":"p"},{"first_character":"o","occurrence_count":3,"second_character":"q"},{"first_character":"o","occurrence_count":1059,"second_character":"r"},{"first_character":"o","occurrence_count":504,"second_character":"s"},{"first_character":"o","occurrence_count":118,"second_character":"t"},{"first_character":"o","occurrence_count":275,"second_character":"u"},{"first_character":"o","occurrence_count":176,"second_character":"v"},{"first_character":"o","occurrence_count":114,"second_character":"w"},{"first_character":"o","occurrence_count":45,"second_character":"x"},{"first_character":"o","occurrence_count":103,"second_character":"y"},{"first_character":"o","occurrence_count":54,"second_character":"z"},{"first_character":"p","occurrence_count":33,"second_character":"."},{"first_character":"p","occurrence_count":209,"second_character":"a"},{"first_character":"p","occurrence_count":2,"second_character":"b"},{"first_character":"p","occurrence_count":1,"second_character":"c"},{"first_character":"p","occurrence_count":0,"second_character":"d"},{"first_character":"p","occurrence_count":197,"second_character":"e"},{"first_character":"p","occurrence_count":1,"second_character":"f"},{"first_character":"p","occurrence_count":0,"second_character":"g"},{"first_character":"p","occurrence_count":204,"second_character":"h"},{"first_character":"p","occurrence_count":61,"second_character":"i"},{"first_character":"p","occurrence_count":1,"second_character":"j"},{"first_character":"p","occurrence_count":1,"second_character":"k"},{"first_character":"p","occurrence_count":16,"second_character":"l"},{"first_character":"p","occurrence_count":1,"second_character":"m"},{"first_character":"p","occurrence_count":1,"second_character":"n"},{"first_character":"p","occurrence_count":59,"second_character":"o"},{"first_character":"p","occurrence_count":39,"second_character":"p"},{"first_character":"p","occurrence_count":0,"second_character":"q"},{"first_character":"p","occurrence_count":151,"second_character":"r"},{"first_character":"p","occurrence_count":16,"second_character":"s"},{"first_character":"p","occurrence_count":17,"second_character":"t"},{"first_character":"p","occurrence_count":4,"second_character":"u"},{"first_character":"p","occurrence_count":0,"second_character":"v"},{"first_character":"p","occurrence_count":0,"second_character":"w"},{"first_character":"p","occurrence_count":0,"second_character":"x"},{"first_character":"p","occurrence_count":12,"second_character":"y"},{"first_character":"p","occurrence_count":0,"second_character":"z"},{"first_character":"q","occurrence_count":28,"second_character":"."},{"first_character":"q","occurrence_count":13,"second_character":"a"},{"first_character":"q","occurrence_count":0,"second_character":"b"},{"first_character":"q","occurrence_count":0,"second_character":"c"},{"first_character":"q","occurrence_count":0,"second_character":"d"},{"first_character":"q","occurrence_count":1,"second_character":"e"},{"first_character":"q","occurrence_count":0,"second_character":"f"},{"first_character":"q","occurrence_count":0,"second_character":"g"},{"first_character":"q","occurrence_count":0,"second_character":"h"},{"first_character":"q","occurrence_count":13,"second_character":"i"},{"first_character":"q","occurrence_count":0,"second_character":"j"},{"first_character":"q","occurrence_count":0,"second_character":"k"},{"first_character":"q","occurrence_count":1,"second_character":"l"},{"first_character":"q","occurrence_count":2,"second_character":"m"},{"first_character":"q","occurrence_count":0,"second_character":"n"},{"first_character":"q","occurrence_count":2,"second_character":"o"},{"first_character":"q","occurrence_count":0,"second_character":"p"},{"first_character":"q","occurrence_count":0,"second_character":"q"},{"first_character":"q","occurrence_count":1,"second_character":"r"},{"first_character":"q","occurrence_count":2,"second_character":"s"},{"first_character":"q","occurrence_count":0,"second_character":"t"},{"first_character":"q","occurrence_count":206,"second_character":"u"},{"first_character":"q","occurrence_count":0,"second_character":"v"},{"first_character":"q","occurrence_count":3,"second_character":"w"},{"first_character":"q","occurrence_count":0,"second_character":"x"},{"first_character":"q","occurrence_count":0,"second_character":"y"},{"first_character":"q","occurrence_count":0,"second_character":"z"},{"first_character":"r","occurrence_count":1377,"second_character":"."},{"first_character":"r","occurrence_count":2356,"second_character":"a"},{"first_character":"r","occurrence_count":41,"second_character":"b"},{"first_character":"r","occurrence_count":99,"second_character":"c"},{"first_character":"r","occurrence_count":187,"second_character":"d"},{"first_character":"r","occurrence_count":1697,"second_character":"e"},{"first_character":"r","occurrence_count":9,"second_character":"f"},{"first_character":"r","occurrence_count":76,"second_character":"g"},{"first_character":"r","occurrence_count":121,"second_character":"h"},{"first_character":"r","occurrence_count":3033,"second_character":"i"},{"first_character":"r","occurrence_count":25,"second_character":"j"},{"first_character":"r","occurrence_count":90,"second_character":"k"},{"first_character":"r","occurrence_count":413,"second_character":"l"},{"first_character":"r","occurrence_count":162,"second_character":"m"},{"first_character":"r","occurrence_count":140,"second_character":"n"},{"first_character":"r","occurrence_count":869,"second_character":"o"},{"first_character":"r","occurrence_count":14,"second_character":"p"},{"first_character":"r","occurrence_count":16,"second_character":"q"},{"first_character":"r","occurrence_count":425,"second_character":"r"},{"first_character":"r","occurrence_count":190,"second_character":"s"},{"first_character":"r","occurrence_count":208,"second_character":"t"},{"first_character":"r","occurrence_count":252,"second_character":"u"},{"first_character":"r","occurrence_count":80,"second_character":"v"},{"first_character":"r","occurrence_count":21,"second_character":"w"},{"first_character":"r","occurrence_count":3,"second_character":"x"},{"first_character":"r","occurrence_count":773,"second_character":"y"},{"first_character":"r","occurrence_count":23,"second_character":"z"},{"first_character":"s","occurrence_count":1169,"second_character":"."},{"first_character":"s","occurrence_count":1201,"second_character":"a"},{"first_character":"s","occurrence_count":21,"second_character":"b"},{"first_character":"s","occurrence_count":60,"second_character":"c"},{"first_character":"s","occurrence_count":9,"second_character":"d"},{"first_character":"s","occurrence_count":884,"second_character":"e"},{"first_character":"s","occurrence_count":2,"second_character":"f"},{"first_character":"s","occurrence_count":2,"second_character":"g"},{"first_character":"s","occurrence_count":1285,"second_character":"h"},{"first_character":"s","occurrence_count":684,"second_character":"i"},{"first_character":"s","occurrence_count":2,"second_character":"j"},{"first_character":"s","occurrence_count":82,"second_character":"k"},{"first_character":"s","occurrence_count":279,"second_character":"l"},{"first_character":"s","occurrence_count":90,"second_character":"m"},{"first_character":"s","occurrence_count":24,"second_character":"n"},{"first_character":"s","occurrence_count":531,"second_character":"o"},{"first_character":"s","occurrence_count":51,"second_character":"p"},{"first_character":"s","occurrence_count":1,"second_character":"q"},{"first_character":"s","occurrence_count":55,"second_character":"r"},{"first_character":"s","occurrence_count":461,"second_character":"s"},{"first_character":"s","occurrence_count":765,"second_character":"t"},{"first_character":"s","occurrence_count":185,"second_character":"u"},{"first_character":"s","occurrence_count":14,"second_character":"v"},{"first_character":"s","occurrence_count":24,"second_character":"w"},{"first_character":"s","occurrence_count":0,"second_character":"x"},{"first_character":"s","occurrence_count":215,"second_character":"y"},{"first_character":"s","occurrence_count":10,"second_character":"z"},{"first_character":"t","occurrence_count":483,"second_character":"."},{"first_character":"t","occurrence_count":1027,"second_character":"a"},{"first_character":"t","occurrence_count":1,"second_character":"b"},{"first_character":"t","occurrence_count":17,"second_character":"c"},{"first_character":"t","occurrence_count":0,"second_character":"d"},{"first_character":"t","occurrence_count":716,"second_character":"e"},{"first_character":"t","occurrence_count":2,"second_character":"f"},{"first_character":"t","occurrence_count":2,"second_character":"g"},{"first_character":"t","occurrence_count":647,"second_character":"h"},{"first_character":"t","occurrence_count":532,"second_character":"i"},{"first_character":"t","occurrence_count":3,"second_character":"j"},{"first_character":"t","occurrence_count":0,"second_character":"k"},{"first_character":"t","occurrence_count":134,"second_character":"l"},{"first_character":"t","occurrence_count":4,"second_character":"m"},{"first_character":"t","occurrence_count":22,"second_character":"n"},{"first_character":"t","occurrence_count":667,"second_character":"o"},{"first_character":"t","occurrence_count":0,"second_character":"p"},{"first_character":"t","occurrence_count":0,"second_character":"q"},{"first_character":"t","occurrence_count":352,"second_character":"r"},{"first_character":"t","occurrence_count":35,"second_character":"s"},{"first_character":"t","occurrence_count":374,"second_character":"t"},{"first_character":"t","occurrence_count":78,"second_character":"u"},{"first_character":"t","occurrence_count":15,"second_character":"v"},{"first_character":"t","occurrence_count":11,"second_character":"w"},{"first_character":"t","occurrence_count":2,"second_character":"x"},{"first_character":"t","occurrence_count":341,"second_character":"y"},{"first_character":"t","occurrence_count":105,"second_character":"z"},{"first_character":"u","occurrence_count":155,"second_character":"."},{"first_character":"u","occurrence_count":163,"second_character":"a"},{"first_character":"u","occurrence_count":103,"second_character":"b"},{"first_character":"u","occurrence_count":103,"second_character":"c"},{"first_character":"u","occurrence_count":136,"second_character":"d"},{"first_character":"u","occurrence_count":169,"second_character":"e"},{"first_character":"u","occurrence_count":19,"second_character":"f"},{"first_character":"u","occurrence_count":47,"second_character":"g"},{"first_character":"u","occurrence_count":58,"second_character":"h"},{"first_character":"u","occurrence_count":121,"second_character":"i"},{"first_character":"u","occurrence_count":14,"second_character":"j"},{"first_character":"u","occurrence_count":93,"second_character":"k"},{"first_character":"u","occurrence_count":301,"second_character":"l"},{"first_character":"u","occurrence_count":154,"second_character":"m"},{"first_character":"u","occurrence_count":275,"second_character":"n"},{"first_character":"u","occurrence_count":10,"second_character":"o"},{"first_character":"u","occurrence_count":16,"second_character":"p"},{"first_character":"u","occurrence_count":10,"second_character":"q"},{"first_character":"u","occurrence_count":414,"second_character":"r"},{"first_character":"u","occurrence_count":474,"second_character":"s"},{"first_character":"u","occurrence_count":82,"second_character":"t"},{"first_character":"u","occurrence_count":3,"second_character":"u"},{"first_character":"u","occurrence_count":37,"second_character":"v"},{"first_character":"u","occurrence_count":86,"second_character":"w"},{"first_character":"u","occurrence_count":34,"second_character":"x"},{"first_character":"u","occurrence_count":13,"second_character":"y"},{"first_character":"u","occurrence_count":45,"second_character":"z"},{"first_character":"v","occurrence_count":88,"second_character":"."},{"first_character":"v","occurrence_count":642,"second_character":"a"},{"first_character":"v","occurrence_count":1,"second_character":"b"},{"first_character":"v","occurrence_count":0,"second_character":"c"},{"first_character":"v","occurrence_count":1,"second_character":"d"},{"first_character":"v","occurrence_count":568,"second_character":"e"},{"first_character":"v","occurrence_count":0,"second_character":"f"},{"first_character":"v","occurrence_count":0,"second_character":"g"},{"first_character":"v","occurrence_count":1,"second_character":"h"},{"first_character":"v","occurrence_count":911,"second_character":"i"},{"first_character":"v","occurrence_count":0,"second_character":"j"},{"first_character":"v","occurrence_count":3,"second_character":"k"},{"first_character":"v","occurrence_count":14,"second_character":"l"},{"first_character":"v","occurrence_count":0,"second_character":"m"},{"first_character":"v","occurrence_count":8,"second_character":"n"},{"first_character":"v","occurrence_count":153,"second_character":"o"},{"first_character":"v","occurrence_count":0,"second_character":"p"},{"first_character":"v","occurrence_count":0,"second_character":"q"},{"first_character":"v","occurrence_count":48,"second_character":"r"},{"first_character":"v","occurrence_count":0,"second_character":"s"},{"first_character":"v","occurrence_count":0,"second_character":"t"},{"first_character":"v","occurrence_count":7,"second_character":"u"},{"first_character":"v","occurrence_count":7,"second_character":"v"},{"first_character":"v","occurrence_count":0,"second_character":"w"},{"first_character":"v","occurrence_count":0,"second_character":"x"},{"first_character":"v","occurrence_count":121,"second_character":"y"},{"first_character":"v","occurrence_count":0,"second_character":"z"},{"first_character":"w","occurrence_count":51,"second_character":"."},{"first_character":"w","occurrence_count":280,"second_character":"a"},{"first_character":"w","occurrence_count":1,"second_character":"b"},{"first_character":"w","occurrence_count":0,"second_character":"c"},{"first_character":"w","occurrence_count":8,"second_character":"d"},{"first_character":"w","occurrence_count":149,"second_character":"e"},{"first_character":"w","occurrence_count":2,"second_character":"f"},{"first_character":"w","occurrence_count":1,"second_character":"g"},{"first_character":"w","occurrence_count":23,"second_character":"h"},{"first_character":"w","occurrence_count":148,"second_character":"i"},{"first_character":"w","occurrence_count":0,"second_character":"j"},{"first_character":"w","occurrence_count":6,"second_character":"k"},{"first_character":"w","occurrence_count":13,"second_character":"l"},{"first_character":"w","occurrence_count":2,"second_character":"m"},{"first_character":"w","occurrence_count":58,"second_character":"n"},{"first_character":"w","occurrence_count":36,"second_character":"o"},{"first_character":"w","occurrence_count":0,"second_character":"p"},{"first_character":"w","occurrence_count":0,"second_character":"q"},{"first_character":"w","occurrence_count":22,"second_character":"r"},{"first_character":"w","occurrence_count":20,"second_character":"s"},{"first_character":"w","occurrence_count":8,"second_character":"t"},{"first_character":"w","occurrence_count":25,"second_character":"u"},{"first_character":"w","occurrence_count":0,"second_character":"v"},{"first_character":"w","occurrence_count":2,"second_character":"w"},{"first_character":"w","occurrence_count":0,"second_character":"x"},{"first_character":"w","occurrence_count":73,"second_character":"y"},{"first_character":"w","occurrence_count":1,"second_character":"z"},{"first_character":"x","occurrence_count":164,"second_character":"."},{"first_character":"x","occurrence_count":103,"second_character":"a"},{"first_character":"x","occurrence_count":1,"second_character":"b"},{"first_character":"x","occurrence_count":4,"second_character":"c"},{"first_character":"x","occurrence_count":5,"second_character":"d"},{"first_character":"x","occurrence_count":36,"second_character":"e"},{"first_character":"x","occurrence_count":3,"second_character":"f"},{"first_character":"x","occurrence_count":0,"second_character":"g"},{"first_character":"x","occurrence_count":1,"second_character":"h"},{"first_character":"x","occurrence_count":102,"second_character":"i"},{"first_character":"x","occurrence_count":0,"second_character":"j"},{"first_character":"x","occurrence_count":0,"second_character":"k"},{"first_character":"x","occurrence_count":39,"second_character":"l"},{"first_character":"x","occurrence_count":1,"second_character":"m"},{"first_character":"x","occurrence_count":1,"second_character":"n"},{"first_character":"x","occurrence_count":41,"second_character":"o"},{"first_character":"x","occurrence_count":0,"second_character":"p"},{"first_character":"x","occurrence_count":0,"second_character":"q"},{"first_character":"x","occurrence_count":0,"second_character":"r"},{"first_character":"x","occurrence_count":31,"second_character":"s"},{"first_character":"x","occurrence_count":70,"second_character":"t"},{"first_character":"x","occurrence_count":5,"second_character":"u"},{"first_character":"x","occurrence_count":0,"second_character":"v"},{"first_character":"x","occurrence_count":3,"second_character":"w"},{"first_character":"x","occurrence_count":38,"second_character":"x"},{"first_character":"x","occurrence_count":30,"second_character":"y"},{"first_character":"x","occurrence_count":19,"second_character":"z"},{"first_character":"y","occurrence_count":2007,"second_character":"."},{"first_character":"y","occurrence_count":2143,"second_character":"a"},{"first_character":"y","occurrence_count":27,"second_character":"b"},{"first_character":"y","occurrence_count":115,"second_character":"c"},{"first_character":"y","occurrence_count":272,"second_character":"d"},{"first_character":"y","occurrence_count":301,"second_character":"e"},{"first_character":"y","occurrence_count":12,"second_character":"f"},{"first_character":"y","occurrence_count":30,"second_character":"g"},{"first_character":"y","occurrence_count":22,"second_character":"h"},{"first_character":"y","occurrence_count":192,"second_character":"i"},{"first_character":"y","occurrence_count":23,"second_character":"j"},{"first_character":"y","occurrence_count":86,"second_character":"k"},{"first_character":"y","occurrence_count":1104,"second_character":"l"},{"first_character":"y","occurrence_count":148,"second_character":"m"},{"first_character":"y","occurrence_count":1826,"second_character":"n"},{"first_character":"y","occurrence_count":271,"second_character":"o"},{"first_character":"y","occurrence_count":15,"second_character":"p"},{"first_character":"y","occurrence_count":6,"second_character":"q"},{"first_character":"y","occurrence_count":291,"second_character":"r"},{"first_character":"y","occurrence_count":401,"second_character":"s"},{"first_character":"y","occurrence_count":104,"second_character":"t"},{"first_character":"y","occurrence_count":141,"second_character":"u"},{"first_character":"y","occurrence_count":106,"second_character":"v"},{"first_character":"y","occurrence_count":4,"second_character":"w"},{"first_character":"y","occurrence_count":28,"second_character":"x"},{"first_character":"y","occurrence_count":23,"second_character":"y"},{"first_character":"y","occurrence_count":78,"second_character":"z"},{"first_character":"z","occurrence_count":160,"second_character":"."},{"first_character":"z","occurrence_count":860,"second_character":"a"},{"first_character":"z","occurrence_count":4,"second_character":"b"},{"first_character":"z","occurrence_count":2,"second_character":"c"},{"first_character":"z","occurrence_count":2,"second_character":"d"},{"first_character":"z","occurrence_count":373,"second_character":"e"},{"first_character":"z","occurrence_count":0,"second_character":"f"},{"first_character":"z","occurrence_count":1,"second_character":"g"},{"first_character":"z","occurrence_count":43,"second_character":"h"},{"first_character":"z","occurrence_count":364,"second_character":"i"},{"first_character":"z","occurrence_count":2,"second_character":"j"},{"first_character":"z","occurrence_count":2,"second_character":"k"},{"first_character":"z","occurrence_count":123,"second_character":"l"},{"first_character":"z","occurrence_count":35,"second_character":"m"},{"first_character":"z","occurrence_count":4,"second_character":"n"},{"first_character":"z","occurrence_count":110,"second_character":"o"},{"first_character":"z","occurrence_count":2,"second_character":"p"},{"first_character":"z","occurrence_count":0,"second_character":"q"},{"first_character":"z","occurrence_count":32,"second_character":"r"},{"first_character":"z","occurrence_count":4,"second_character":"s"},{"first_character":"z","occurrence_count":4,"second_character":"t"},{"first_character":"z","occurrence_count":73,"second_character":"u"},{"first_character":"z","occurrence_count":2,"second_character":"v"},{"first_character":"z","occurrence_count":3,"second_character":"w"},{"first_character":"z","occurrence_count":1,"second_character":"x"},{"first_character":"z","occurrence_count":147,"second_character":"y"},{"first_character":"z","occurrence_count":45,"second_character":"z"}]},"layer":[{"encoding":{"color":{"aggregate":"sum","field":"occurrence_count","legend":false,"type":"quantitative"},"x":{"axis":{"labelAngle":0,"orient":"top"},"field":"second_character","type":"nominal"},"y":{"field":"first_character","type":"nominal"}},"mark":{"fillOpacity":1,"tooltip":true,"type":"rect"}},{"encoding":{"text":{"aggregate":"sum","field":"occurrence_count","type":"quantitative"},"x":{"axis":{"labelAngle":0,"orient":"top"},"field":"second_character","type":"nominal"},"y":{"field":"first_character","type":"nominal"}},"mark":"text"}],"width":800}
```

## Nx Tensor

```elixir
# Use the XLA backend for Nx so that computations are done more efficiently
# using Google's Accelerated Linear Algebra library.
Nx.global_default_backend(EXLA.Backend)
```

<!-- livebook:{"output":true} -->

```
{Nx.BinaryBackend, []}
```

To start being efficient with the models we create we can leverage the nurmerical Elixir library `Nx` ([docs](https://hexdocs.pm/nx/Nx.html)).

We can create a 2-dimensional tensor to store the count of the bigrams.

```elixir
vocabulary = Enum.concat([?.], ?a..?z)
vocabulary_size = length(vocabulary)

bigram_matrix =
  List.duplicate(0, vocabulary_size * vocabulary_size)
  |> Nx.tensor(type: :u32)
  |> Nx.reshape({vocabulary_size, vocabulary_size})
```

<!-- livebook:{"output":true} -->

```
#Nx.Tensor<
  u32[27][27]
  EXLA.Backend<host:0, 0.1565027411.2003173392.234732>
  [
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...],
    ...
  ]
>
```

```elixir
defmodule BigramMapping do
  def str_to_int("."), do: 0
  def str_to_int(char), do: hd(to_charlist(char)) - ?a + 1

  def int_to_str(0), do: "."
  def int_to_str(int), do: to_string([int + ?a - 1])

  def encode([c1, c2]), do: [str_to_int(c1), str_to_int(c2)]

  def decode([c1, c2]), do: [int_to_str(c1), int_to_str(c2)]
end
```

<!-- livebook:{"output":true} -->

```
{:module, BigramMapping, <<70, 79, 82, 49, 0, 0, 12, ...>>, {:decode, 1}}
```

```elixir
bigram_matrix =
  Enum.reduce(bigram_count, bigram_matrix, fn {bigram, count}, tensor ->
    t_index = Nx.tensor(BigramMapping.encode(bigram))
    Nx.indexed_add(tensor, t_index, count)
  end)
```

<!-- livebook:{"output":true} -->

```
#Nx.Tensor<
  s64[27][27]
  EXLA.Backend<host:0, 0.1565027411.2003173392.236617>
  [
    [0, 4410, 1306, 1542, 1690, 1531, 417, 669, 874, 591, 2422, 2963, 1572, 2538, 1146, 394, 515, 92, 1639, 2055, 1308, 78, 376, 307, 134, 535, 929],
    [6640, 556, 541, 470, 1042, 692, 134, 168, 2332, 1650, 175, 568, 2528, 1634, 5438, 63, 82, 60, 3264, 1118, 687, 381, 834, ...],
    ...
  ]
>
```

## Simple probability model

We can take this bigram matrix and create a probability matrix telling us the liklihood of each character following the given character. For that we just need to divide each count in the matrix by the sum of the row.

```elixir
bigram_matrix_probabilites =
  Nx.divide(
    bigram_matrix,
    Nx.sum(bigram_matrix, axes: [1], keep_axes: true)
  )
```

<!-- livebook:{"output":true} -->

```
#Nx.Tensor<
  f32[27][27]
  EXLA.Backend<host:0, 0.1565027411.2003173392.236621>
  [
    [0.0, 0.13767053186893463, 0.040770456194877625, 0.048137858510017395, 0.05275809392333031, 0.047794461250305176, 0.013017825782299042, 0.020884713158011436, 0.02728436328470707, 0.018449723720550537, 0.07560952752828598, 0.09249836206436157, 0.04907439276576042, 0.07923079282045364, 0.03577560558915138, 0.012299816124141216, 0.01607717014849186, 0.0028720381669700146, 0.05116598680615425, 0.06415259093046188, 0.040832892060279846, 0.002434988971799612, 0.01173789519816637, 0.009583866223692894, 0.0041831862181425095, 0.016701526939868927, 0.02900134213268757],
    [0.19595691561698914, 0.016408439725637436, 0.015965767204761505, 0.013870444148778915, 0.030751070007681847, 0.020422015339136124, 0.003954552114009857, 0.004957946017384529, 0.0688210129737854, 0.04869411140680313, 0.005164526868611574, 0.01676257885992527, 0.07460528612136841, 0.048221927136182785, 0.16048398613929749, 0.0018592297565191984, 0.0024199497420340776, 0.0017706949729472399, 0.09632580727338791, 0.032993949949741364, 0.020274458453059196, 0.011243913322687149, 0.024612659588456154, ...],
    ...
  ]
>
```

```elixir
for x <- 0..(vocabulary_size - 1), y <- 0..(vocabulary_size - 1) do  
  %{
    "first_character" => BigramMapping.int_to_str(x),
    "second_character" => BigramMapping.int_to_str(y),
    "occurrence_count" =>
      (Nx.to_number(bigram_matrix_probabilites[x][y]) * 100)
      |> Float.round(2)
  }
end
|> Tucan.heatmap(
  "second_character",
  "first_character",
  "occurrence_count",
  annotate: true,
  tooltip: true,
  color: [legend: false],
  x: [axis: [orient: :top, label_angle: 0]]
)
|> Tucan.set_theme(:power_bi)
|> Tucan.set_width(850)
```

<!-- livebook:{"output":true} -->

```vega-lite
{"$schema":"https://vega.github.io/schema/vega-lite/v5.json","__tucan__":{"multilayer":true,"types":{"first_character":"nominal","occurrence_count":"quantitative","second_character":"nominal"}},"config":{"arc":{"fill":"#118DFF"},"area":{"fill":"#118DFF","line":true,"opacity":0.6},"axis":{"domain":false,"grid":false,"labelColor":"#605E5C","labelFontSize":12.0,"ticks":false,"titleColor":"#252423","titleFont":"wf_standard-font, helvetica, arial, sans-serif","titleFontSize":16.0,"titleFontWeight":"normal"},"axisBand":{"tickExtra":true},"axisQuantitative":{"grid":true,"gridColor":"#c8C6C4","gridDash":[1,5],"labelFlush":false,"tickCount":3},"axisX":{"labelPadding":5},"axisY":{"labelPadding":10},"background":"transparent","bar":{"fill":"#118DFF"},"font":"segoe uI","header":{"labelColor":"#605E5C","labelFont":"segoe uI","labelFontSize":13.333333333333332,"titleColor":"#252423","titleFont":"wf_standard-font, helvetica, arial, sans-serif","titleFontSize":16.0},"legend":{"labelColor":"#605E5C","labelFont":"segoe uI","labelFontSize":13.333333333333332,"symbolSize":75,"symbolType":"circle","titleColor":"#605E5C","titleFont":"segoe uI","titleFontWeight":"bold"},"line":{"stroke":"#118DFF","strokeCap":"round","strokeJoin":"round","strokeWidth":3},"path":{"stroke":"#118DFF"},"point":{"fill":"#118DFF","filled":true,"size":75},"range":{"category":["#118DFF","#12239E","#e66C37","#6B007B","#e044A7","#744EC2","#d9B300","#d64550"],"diverging":["#dEEFFF","#118DFF"],"heatmap":["#dEEFFF","#118DFF"],"ordinal":["#dEEFFF","#c7e4ff","#b0d9ff","#9aceff","#83c3ff","#6cb9ff","#55aeff","#3fa3ff","#2898ff","#118DFF"]},"rect":{"fill":"#118DFF"},"shape":{"stroke":"#118DFF"},"symbol":{"fill":"#118DFF","size":50,"strokeWidth":1.5},"text":{"fill":"#605E5C","font":"segoe uI","fontSize":12.0},"view":{"stroke":"transparent"}},"data":{"values":[{"first_character":".","occurrence_count":0.0,"second_character":"."},{"first_character":".","occurrence_count":13.77,"second_character":"a"},{"first_character":".","occurrence_count":4.08,"second_character":"b"},{"first_character":".","occurrence_count":4.81,"second_character":"c"},{"first_character":".","occurrence_count":5.28,"second_character":"d"},{"first_character":".","occurrence_count":4.78,"second_character":"e"},{"first_character":".","occurrence_count":1.3,"second_character":"f"},{"first_character":".","occurrence_count":2.09,"second_character":"g"},{"first_character":".","occurrence_count":2.73,"second_character":"h"},{"first_character":".","occurrence_count":1.84,"second_character":"i"},{"first_character":".","occurrence_count":7.56,"second_character":"j"},{"first_character":".","occurrence_count":9.25,"second_character":"k"},{"first_character":".","occurrence_count":4.91,"second_character":"l"},{"first_character":".","occurrence_count":7.92,"second_character":"m"},{"first_character":".","occurrence_count":3.58,"second_character":"n"},{"first_character":".","occurrence_count":1.23,"second_character":"o"},{"first_character":".","occurrence_count":1.61,"second_character":"p"},{"first_character":".","occurrence_count":0.29,"second_character":"q"},{"first_character":".","occurrence_count":5.12,"second_character":"r"},{"first_character":".","occurrence_count":6.42,"second_character":"s"},{"first_character":".","occurrence_count":4.08,"second_character":"t"},{"first_character":".","occurrence_count":0.24,"second_character":"u"},{"first_character":".","occurrence_count":1.17,"second_character":"v"},{"first_character":".","occurrence_count":0.96,"second_character":"w"},{"first_character":".","occurrence_count":0.42,"second_character":"x"},{"first_character":".","occurrence_count":1.67,"second_character":"y"},{"first_character":".","occurrence_count":2.9,"second_character":"z"},{"first_character":"a","occurrence_count":19.6,"second_character":"."},{"first_character":"a","occurrence_count":1.64,"second_character":"a"},{"first_character":"a","occurrence_count":1.6,"second_character":"b"},{"first_character":"a","occurrence_count":1.39,"second_character":"c"},{"first_character":"a","occurrence_count":3.08,"second_character":"d"},{"first_character":"a","occurrence_count":2.04,"second_character":"e"},{"first_character":"a","occurrence_count":0.4,"second_character":"f"},{"first_character":"a","occurrence_count":0.5,"second_character":"g"},{"first_character":"a","occurrence_count":6.88,"second_character":"h"},{"first_character":"a","occurrence_count":4.87,"second_character":"i"},{"first_character":"a","occurrence_count":0.52,"second_character":"j"},{"first_character":"a","occurrence_count":1.68,"second_character":"k"},{"first_character":"a","occurrence_count":7.46,"second_character":"l"},{"first_character":"a","occurrence_count":4.82,"second_character":"m"},{"first_character":"a","occurrence_count":16.05,"second_character":"n"},{"first_character":"a","occurrence_count":0.19,"second_character":"o"},{"first_character":"a","occurrence_count":0.24,"second_character":"p"},{"first_character":"a","occurrence_count":0.18,"second_character":"q"},{"first_character":"a","occurrence_count":9.63,"second_character":"r"},{"first_character":"a","occurrence_count":3.3,"second_character":"s"},{"first_character":"a","occurrence_count":2.03,"second_character":"t"},{"first_character":"a","occurrence_count":1.12,"second_character":"u"},{"first_character":"a","occurrence_count":2.46,"second_character":"v"},{"first_character":"a","occurrence_count":0.48,"second_character":"w"},{"first_character":"a","occurrence_count":0.54,"second_character":"x"},{"first_character":"a","occurrence_count":6.05,"second_character":"y"},{"first_character":"a","occurrence_count":1.28,"second_character":"z"},{"first_character":"b","occurrence_count":4.31,"second_character":"."},{"first_character":"b","occurrence_count":12.14,"second_character":"a"},{"first_character":"b","occurrence_count":1.44,"second_character":"b"},{"first_character":"b","occurrence_count":0.04,"second_character":"c"},{"first_character":"b","occurrence_count":2.46,"second_character":"d"},{"first_character":"b","occurrence_count":24.76,"second_character":"e"},{"first_character":"b","occurrence_count":0.0,"second_character":"f"},{"first_character":"b","occurrence_count":0.0,"second_character":"g"},{"first_character":"b","occurrence_count":1.55,"second_character":"h"},{"first_character":"b","occurrence_count":8.2,"second_character":"i"},{"first_character":"b","occurrence_count":0.04,"second_character":"j"},{"first_character":"b","occurrence_count":0.0,"second_character":"k"},{"first_character":"b","occurrence_count":3.89,"second_character":"l"},{"first_character":"b","occurrence_count":0.0,"second_character":"m"},{"first_character":"b","occurrence_count":0.15,"second_character":"n"},{"first_character":"b","occurrence_count":3.97,"second_character":"o"},{"first_character":"b","occurrence_count":0.0,"second_character":"p"},{"first_character":"b","occurrence_count":0.0,"second_character":"q"},{"first_character":"b","occurrence_count":31.83,"second_character":"r"},{"first_character":"b","occurrence_count":0.3,"second_character":"s"},{"first_character":"b","occurrence_count":0.08,"second_character":"t"},{"first_character":"b","occurrence_count":1.7,"second_character":"u"},{"first_character":"b","occurrence_count":0.0,"second_character":"v"},{"first_character":"b","occurrence_count":0.0,"second_character":"w"},{"first_character":"b","occurrence_count":0.0,"second_character":"x"},{"first_character":"b","occurrence_count":3.14,"second_character":"y"},{"first_character":"b","occurrence_count":0.0,"second_character":"z"},{"first_character":"c","occurrence_count":2.75,"second_character":"."},{"first_character":"c","occurrence_count":23.07,"second_character":"a"},{"first_character":"c","occurrence_count":0.0,"second_character":"b"},{"first_character":"c","occurrence_count":1.19,"second_character":"c"},{"first_character":"c","occurrence_count":0.03,"second_character":"d"},{"first_character":"c","occurrence_count":15.6,"second_character":"e"},{"first_character":"c","occurrence_count":0.0,"second_character":"f"},{"first_character":"c","occurrence_count":0.06,"second_character":"g"},{"first_character":"c","occurrence_count":18.8,"second_character":"h"},{"first_character":"c","occurrence_count":7.67,"second_character":"i"},{"first_character":"c","occurrence_count":0.08,"second_character":"j"},{"first_character":"c","occurrence_count":8.95,"second_character":"k"},{"first_character":"c","occurrence_count":3.28,"second_character":"l"},{"first_character":"c","occurrence_count":0.0,"second_character":"m"},{"first_character":"c","occurrence_count":0.0,"second_character":"n"},{"first_character":"c","occurrence_count":10.76,"second_character":"o"},{"first_character":"c","occurrence_count":0.03,"second_character":"p"},{"first_character":"c","occurrence_count":0.31,"second_character":"q"},{"first_character":"c","occurrence_count":2.15,"second_character":"r"},{"first_character":"c","occurrence_count":0.14,"second_character":"s"},{"first_character":"c","occurrence_count":0.99,"second_character":"t"},{"first_character":"c","occurrence_count":0.99,"second_character":"u"},{"first_character":"c","occurrence_count":0.0,"second_character":"v"},{"first_character":"c","occurrence_count":0.0,"second_character":"w"},{"first_character":"c","occurrence_count":0.08,"second_character":"x"},{"first_character":"c","occurrence_count":2.94,"second_character":"y"},{"first_character":"c","occurrence_count":0.11,"second_character":"z"},{"first_character":"d","occurrence_count":9.39,"second_character":"."},{"first_character":"d","occurrence_count":23.71,"second_character":"a"},{"first_character":"d","occurrence_count":0.02,"second_character":"b"},{"first_character":"d","occurrence_count":0.05,"second_character":"c"},{"first_character":"d","occurrence_count":2.71,"second_character":"d"},{"first_character":"d","occurrence_count":23.34,"second_character":"e"},{"first_character":"d","occurrence_count":0.09,"second_character":"f"},{"first_character":"d","occurrence_count":0.45,"second_character":"g"},{"first_character":"d","occurrence_count":2.15,"second_character":"h"},{"first_character":"d","occurrence_count":12.26,"second_character":"i"},{"first_character":"d","occurrence_count":0.16,"second_character":"j"},{"first_character":"d","occurrence_count":0.05,"second_character":"k"},{"first_character":"d","occurrence_count":1.09,"second_character":"l"},{"first_character":"d","occurrence_count":0.55,"second_character":"m"},{"first_character":"d","occurrence_count":0.56,"second_character":"n"},{"first_character":"d","occurrence_count":6.88,"second_character":"o"},{"first_character":"d","occurrence_count":0.0,"second_character":"p"},{"first_character":"d","occurrence_count":0.02,"second_character":"q"},{"first_character":"d","occurrence_count":7.71,"second_character":"r"},{"first_character":"d","occurrence_count":0.53,"second_character":"s"},{"first_character":"d","occurrence_count":0.07,"second_character":"t"},{"first_character":"d","occurrence_count":1.67,"second_character":"u"},{"first_character":"d","occurrence_count":0.31,"second_character":"v"},{"first_character":"d","occurrence_count":0.42,"second_character":"w"},{"first_character":"d","occurrence_count":0.0,"second_character":"x"},{"first_character":"d","occurrence_count":5.77,"second_character":"y"},{"first_character":"d","occurrence_count":0.02,"second_character":"z"},{"first_character":"e","occurrence_count":19.5,"second_character":"."},{"first_character":"e","occurrence_count":3.32,"second_character":"a"},{"first_character":"e","occurrence_count":0.59,"second_character":"b"},{"first_character":"e","occurrence_count":0.75,"second_character":"c"},{"first_character":"e","occurrence_count":1.88,"second_character":"d"},{"first_character":"e","occurrence_count":6.22,"second_character":"e"},{"first_character":"e","occurrence_count":0.4,"second_character":"f"},{"first_character":"e","occurrence_count":0.61,"second_character":"g"},{"first_character":"e","occurrence_count":0.74,"second_character":"h"},{"first_character":"e","occurrence_count":4.01,"second_character":"i"},{"first_character":"e","occurrence_count":0.27,"second_character":"j"},{"first_character":"e","occurrence_count":0.87,"second_character":"k"},{"first_character":"e","occurrence_count":15.9,"second_character":"l"},{"first_character":"e","occurrence_count":3.77,"second_character":"m"},{"first_character":"e","occurrence_count":13.1,"second_character":"n"},{"first_character":"e","occurrence_count":1.32,"second_character":"o"},{"first_character":"e","occurrence_count":0.41,"second_character":"p"},{"first_character":"e","occurrence_count":0.07,"second_character":"q"},{"first_character":"e","occurrence_count":9.59,"second_character":"r"},{"first_character":"e","occurrence_count":4.22,"second_character":"s"},{"first_character":"e","occurrence_count":2.84,"second_character":"t"},{"first_character":"e","occurrence_count":0.34,"second_character":"u"},{"first_character":"e","occurrence_count":2.27,"second_character":"v"},{"first_character":"e","occurrence_count":0.24,"second_character":"w"},{"first_character":"e","occurrence_count":0.65,"second_character":"x"},{"first_character":"e","occurrence_count":5.24,"second_character":"y"},{"first_character":"e","occurrence_count":0.89,"second_character":"z"},{"first_character":"f","occurrence_count":8.84,"second_character":"."},{"first_character":"f","occurrence_count":26.74,"second_character":"a"},{"first_character":"f","occurrence_count":0.0,"second_character":"b"},{"first_character":"f","occurrence_count":0.0,"second_character":"c"},{"first_character":"f","occurrence_count":0.0,"second_character":"d"},{"first_character":"f","occurrence_count":13.59,"second_character":"e"},{"first_character":"f","occurrence_count":4.86,"second_character":"f"},{"first_character":"f","occurrence_count":0.11,"second_character":"g"},{"first_character":"f","occurrence_count":0.11,"second_character":"h"},{"first_character":"f","occurrence_count":17.68,"second_character":"i"},{"first_character":"f","occurrence_count":0.0,"second_character":"j"},{"first_character":"f","occurrence_count":0.22,"second_character":"k"},{"first_character":"f","occurrence_count":2.21,"second_character":"l"},{"first_character":"f","occurrence_count":0.0,"second_character":"m"},{"first_character":"f","occurrence_count":0.44,"second_character":"n"},{"first_character":"f","occurrence_count":6.63,"second_character":"o"},{"first_character":"f","occurrence_count":0.0,"second_character":"p"},{"first_character":"f","occurrence_count":0.0,"second_character":"q"},{"first_character":"f","occurrence_count":12.6,"second_character":"r"},{"first_character":"f","occurrence_count":0.66,"second_character":"s"},{"first_character":"f","occurrence_count":1.99,"second_character":"t"},{"first_character":"f","occurrence_count":1.1,"second_character":"u"},{"first_character":"f","occurrence_count":0.0,"second_character":"v"},{"first_character":"f","occurrence_count":0.44,"second_character":"w"},{"first_character":"f","occurrence_count":0.0,"second_character":"x"},{"first_character":"f","occurrence_count":1.55,"second_character":"y"},{"first_character":"f","occurrence_count":0.22,"second_character":"z"},{"first_character":"g","occurrence_count":5.6,"second_character":"."},{"first_character":"g","occurrence_count":17.13,"second_character":"a"},{"first_character":"g","occurrence_count":0.16,"second_character":"b"},{"first_character":"g","occurrence_count":0.0,"second_character":"c"},{"first_character":"g","occurrence_count":0.99,"second_character":"d"},{"first_character":"g","occurrence_count":17.33,"second_character":"e"},{"first_character":"g","occurrence_count":0.05,"second_character":"f"},{"first_character":"g","occurrence_count":1.3,"second_character":"g"},{"first_character":"g","occurrence_count":18.68,"second_character":"h"},{"first_character":"g","occurrence_count":9.86,"second_character":"i"},{"first_character":"g","occurrence_count":0.16,"second_character":"j"},{"first_character":"g","occurrence_count":0.0,"second_character":"k"},{"first_character":"g","occurrence_count":1.66,"second_character":"l"},{"first_character":"g","occurrence_count":0.31,"second_character":"m"},{"first_character":"g","occurrence_count":1.4,"second_character":"n"},{"first_character":"g","occurrence_count":4.31,"second_character":"o"},{"first_character":"g","occurrence_count":0.0,"second_character":"p"},{"first_character":"g","occurrence_count":0.0,"second_character":"q"},{"first_character":"g","occurrence_count":10.43,"second_character":"r"},{"first_character":"g","occurrence_count":1.56,"second_character":"s"},{"first_character":"g","occurrence_count":1.61,"second_character":"t"},{"first_character":"g","occurrence_count":4.41,"second_character":"u"},{"first_character":"g","occurrence_count":0.05,"second_character":"v"},{"first_character":"g","occurrence_count":1.35,"second_character":"w"},{"first_character":"g","occurrence_count":0.0,"second_character":"x"},{"first_character":"g","occurrence_count":1.61,"second_character":"y"},{"first_character":"g","occurrence_count":0.05,"second_character":"z"},{"first_character":"h","occurrence_count":31.63,"second_character":"."},{"first_character":"h","occurrence_count":29.46,"second_character":"a"},{"first_character":"h","occurrence_count":0.11,"second_character":"b"},{"first_character":"h","occurrence_count":0.03,"second_character":"c"},{"first_character":"h","occurrence_count":0.32,"second_character":"d"},{"first_character":"h","occurrence_count":8.85,"second_character":"e"},{"first_character":"h","occurrence_count":0.03,"second_character":"f"},{"first_character":"h","occurrence_count":0.03,"second_character":"g"},{"first_character":"h","occurrence_count":0.01,"second_character":"h"},{"first_character":"h","occurrence_count":9.57,"second_character":"i"},{"first_character":"h","occurrence_count":0.12,"second_character":"j"},{"first_character":"h","occurrence_count":0.38,"second_character":"k"},{"first_character":"h","occurrence_count":2.43,"second_character":"l"},{"first_character":"h","occurrence_count":1.54,"second_character":"m"},{"first_character":"h","occurrence_count":1.81,"second_character":"n"},{"first_character":"h","occurrence_count":3.77,"second_character":"o"},{"first_character":"h","occurrence_count":0.01,"second_character":"p"},{"first_character":"h","occurrence_count":0.01,"second_character":"q"},{"first_character":"h","occurrence_count":2.68,"second_character":"r"},{"first_character":"h","occurrence_count":0.41,"second_character":"s"},{"first_character":"h","occurrence_count":0.93,"second_character":"t"},{"first_character":"h","occurrence_count":2.18,"second_character":"u"},{"first_character":"h","occurrence_count":0.51,"second_character":"v"},{"first_character":"h","occurrence_count":0.13,"second_character":"w"},{"first_character":"h","occurrence_count":0.0,"second_character":"x"},{"first_character":"h","occurrence_count":2.8,"second_character":"y"},{"first_character":"h","occurrence_count":0.26,"second_character":"z"},{"first_character":"i","occurrence_count":14.06,"second_character":"."},{"first_character":"i","occurrence_count":13.81,"second_character":"a"},{"first_character":"i","occurrence_count":0.62,"second_character":"b"},{"first_character":"i","occurrence_count":2.88,"second_character":"c"},{"first_character":"i","occurrence_count":2.49,"second_character":"d"},{"first_character":"i","occurrence_count":9.34,"second_character":"e"},{"first_character":"i","occurrence_count":0.57,"second_character":"f"},{"first_character":"i","occurrence_count":2.42,"second_character":"g"},{"first_character":"i","occurrence_count":0.54,"second_character":"h"},{"first_character":"i","occurrence_count":0.46,"second_character":"i"},{"first_character":"i","occurrence_count":0.43,"second_character":"j"},{"first_character":"i","occurrence_count":2.51,"second_character":"k"},{"first_character":"i","occurrence_count":7.6,"second_character":"l"},{"first_character":"i","occurrence_count":2.41,"second_character":"m"},{"first_character":"i","occurrence_count":12.01,"second_character":"n"},{"first_character":"i","occurrence_count":3.32,"second_character":"o"},{"first_character":"i","occurrence_count":0.3,"second_character":"p"},{"first_character":"i","occurrence_count":0.29,"second_character":"q"},{"first_character":"i","occurrence_count":4.8,"second_character":"r"},{"first_character":"i","occurrence_count":7.43,"second_character":"s"},{"first_character":"i","occurrence_count":3.06,"second_character":"t"},{"first_character":"i","occurrence_count":0.62,"second_character":"u"},{"first_character":"i","occurrence_count":1.52,"second_character":"v"},{"first_character":"i","occurrence_count":0.05,"second_character":"w"},{"first_character":"i","occurrence_count":0.5,"second_character":"x"},{"first_character":"i","occurrence_count":4.4,"second_character":"y"},{"first_character":"i","occurrence_count":1.56,"second_character":"z"},{"first_character":"j","occurrence_count":2.45,"second_character":"."},{"first_character":"j","occurrence_count":50.79,"second_character":"a"},{"first_character":"j","occurrence_count":0.03,"second_character":"b"},{"first_character":"j","occurrence_count":0.14,"second_character":"c"},{"first_character":"j","occurrence_count":0.14,"second_character":"d"},{"first_character":"j","occurrence_count":15.17,"second_character":"e"},{"first_character":"j","occurrence_count":0.0,"second_character":"f"},{"first_character":"j","occurrence_count":0.0,"second_character":"g"},{"first_character":"j","occurrence_count":1.55,"second_character":"h"},{"first_character":"j","occurrence_count":4.1,"second_character":"i"},{"first_character":"j","occurrence_count":0.07,"second_character":"j"},{"first_character":"j","occurrence_count":0.07,"second_character":"k"},{"first_character":"j","occurrence_count":0.31,"second_character":"l"},{"first_character":"j","occurrence_count":0.17,"second_character":"m"},{"first_character":"j","occurrence_count":0.07,"second_character":"n"},{"first_character":"j","occurrence_count":16.52,"second_character":"o"},{"first_character":"j","occurrence_count":0.03,"second_character":"p"},{"first_character":"j","occurrence_count":0.0,"second_character":"q"},{"first_character":"j","occurrence_count":0.38,"second_character":"r"},{"first_character":"j","occurrence_count":0.24,"second_character":"s"},{"first_character":"j","occurrence_count":0.07,"second_character":"t"},{"first_character":"j","occurrence_count":6.97,"second_character":"u"},{"first_character":"j","occurrence_count":0.17,"second_character":"v"},{"first_character":"j","occurrence_count":0.21,"second_character":"w"},{"first_character":"j","occurrence_count":0.0,"second_character":"x"},{"first_character":"j","occurrence_count":0.34,"second_character":"y"},{"first_character":"j","occurrence_count":0.0,"second_character":"z"},{"first_character":"k","occurrence_count":7.2,"second_character":"."},{"first_character":"k","occurrence_count":34.35,"second_character":"a"},{"first_character":"k","occurrence_count":0.04,"second_character":"b"},{"first_character":"k","occurrence_count":0.04,"second_character":"c"},{"first_character":"k","occurrence_count":0.04,"second_character":"d"},{"first_character":"k","occurrence_count":17.76,"second_character":"e"},{"first_character":"k","occurrence_count":0.02,"second_character":"f"},{"first_character":"k","occurrence_count":0.0,"second_character":"g"},{"first_character":"k","occurrence_count":6.09,"second_character":"h"},{"first_character":"k","occurrence_count":10.1,"second_character":"i"},{"first_character":"k","occurrence_count":0.04,"second_character":"j"},{"first_character":"k","occurrence_count":0.4,"second_character":"k"},{"first_character":"k","occurrence_count":2.76,"second_character":"l"},{"first_character":"k","occurrence_count":0.18,"second_character":"m"},{"first_character":"k","occurrence_count":0.52,"second_character":"n"},{"first_character":"k","occurrence_count":6.83,"second_character":"o"},{"first_character":"k","occurrence_count":0.0,"second_character":"p"},{"first_character":"k","occurrence_count":0.0,"second_character":"q"},{"first_character":"k","occurrence_count":2.16,"second_character":"r"},{"first_character":"k","occurrence_count":1.88,"second_character":"s"},{"first_character":"k","occurrence_count":0.34,"second_character":"t"},{"first_character":"k","occurrence_count":0.99,"second_character":"u"},{"first_character":"k","occurrence_count":0.04,"second_character":"v"},{"first_character":"k","occurrence_count":0.67,"second_character":"w"},{"first_character":"k","occurrence_count":0.0,"second_character":"x"},{"first_character":"k","occurrence_count":7.52,"second_character":"y"},{"first_character":"k","occurrence_count":0.04,"second_character":"z"},{"first_character":"l","occurrence_count":9.41,"second_character":"."},{"first_character":"l","occurrence_count":18.79,"second_character":"a"},{"first_character":"l","occurrence_count":0.37,"second_character":"b"},{"first_character":"l","occurrence_count":0.18,"second_character":"c"},{"first_character":"l","occurrence_count":0.99,"second_character":"d"},{"first_character":"l","occurrence_count":20.93,"second_character":"e"},{"first_character":"l","occurrence_count":0.16,"second_character":"f"},{"first_character":"l","occurrence_count":0.04,"second_character":"g"},{"first_character":"l","occurrence_count":0.14,"second_character":"h"},{"first_character":"l","occurrence_count":17.77,"second_character":"i"},{"first_character":"l","occurrence_count":0.04,"second_character":"j"},{"first_character":"l","occurrence_count":0.17,"second_character":"k"},{"first_character":"l","occurrence_count":9.64,"second_character":"l"},{"first_character":"l","occurrence_count":0.43,"second_character":"m"},{"first_character":"l","occurrence_count":0.1,"second_character":"n"},{"first_character":"l","occurrence_count":4.96,"second_character":"o"},{"first_character":"l","occurrence_count":0.11,"second_character":"p"},{"first_character":"l","occurrence_count":0.02,"second_character":"q"},{"first_character":"l","occurrence_count":0.13,"second_character":"r"},{"first_character":"l","occurrence_count":0.67,"second_character":"s"},{"first_character":"l","occurrence_count":0.55,"second_character":"t"},{"first_character":"l","occurrence_count":2.32,"second_character":"u"},{"first_character":"l","occurrence_count":0.52,"second_character":"v"},{"first_character":"l","occurrence_count":0.11,"second_character":"w"},{"first_character":"l","occurrence_count":0.0,"second_character":"x"},{"first_character":"l","occurrence_count":11.38,"second_character":"y"},{"first_character":"l","occurrence_count":0.07,"second_character":"z"},{"first_character":"m","occurrence_count":7.77,"second_character":"."},{"first_character":"m","occurrence_count":38.99,"second_character":"a"},{"first_character":"m","occurrence_count":1.69,"second_character":"b"},{"first_character":"m","occurrence_count":0.77,"second_character":"c"},{"first_character":"m","occurrence_count":0.36,"second_character":"d"},{"first_character":"m","occurrence_count":12.32,"second_character":"e"},{"first_character":"m","occurrence_count":0.02,"second_character":"f"},{"first_character":"m","occurrence_count":0.0,"second_character":"g"},{"first_character":"m","occurrence_count":0.08,"second_character":"h"},{"first_character":"m","occurrence_count":18.91,"second_character":"i"},{"first_character":"m","occurrence_count":0.11,"second_character":"j"},{"first_character":"m","occurrence_count":0.02,"second_character":"k"},{"first_character":"m","occurrence_count":0.08,"second_character":"l"},{"first_character":"m","occurrence_count":2.53,"second_character":"m"},{"first_character":"m","occurrence_count":0.3,"second_character":"n"},{"first_character":"m","occurrence_count":6.81,"second_character":"o"},{"first_character":"m","occurrence_count":0.57,"second_character":"p"},{"first_character":"m","occurrence_count":0.0,"second_character":"q"},{"first_character":"m","occurrence_count":1.46,"second_character":"r"},{"first_character":"m","occurrence_count":0.53,"second_character":"s"},{"first_character":"m","occurrence_count":0.06,"second_character":"t"},{"first_character":"m","occurrence_count":2.09,"second_character":"u"},{"first_character":"m","occurrence_count":0.05,"second_character":"v"},{"first_character":"m","occurrence_count":0.03,"second_character":"w"},{"first_character":"m","occurrence_count":0.0,"second_character":"x"},{"first_character":"m","occurrence_count":4.32,"second_character":"y"},{"first_character":"m","occurrence_count":0.17,"second_character":"z"},{"first_character":"n","occurrence_count":36.9,"second_character":"."},{"first_character":"n","occurrence_count":16.24,"second_character":"a"},{"first_character":"n","occurrence_count":0.04,"second_character":"b"},{"first_character":"n","occurrence_count":1.16,"second_character":"c"},{"first_character":"n","occurrence_count":3.84,"second_character":"d"},{"first_character":"n","occurrence_count":7.42,"second_character":"e"},{"first_character":"n","occurrence_count":0.06,"second_character":"f"},{"first_character":"n","occurrence_count":1.49,"second_character":"g"},{"first_character":"n","occurrence_count":0.14,"second_character":"h"},{"first_character":"n","occurrence_count":9.41,"second_character":"i"},{"first_character":"n","occurrence_count":0.24,"second_character":"j"},{"first_character":"n","occurrence_count":0.32,"second_character":"k"},{"first_character":"n","occurrence_count":1.06,"second_character":"l"},{"first_character":"n","occurrence_count":0.1,"second_character":"m"},{"first_character":"n","occurrence_count":10.4,"second_character":"n"},{"first_character":"n","occurrence_count":2.71,"second_character":"o"},{"first_character":"n","occurrence_count":0.03,"second_character":"p"},{"first_character":"n","occurrence_count":0.01,"second_character":"q"},{"first_character":"n","occurrence_count":0.24,"second_character":"r"},{"first_character":"n","occurrence_count":1.52,"second_character":"s"},{"first_character":"n","occurrence_count":2.42,"second_character":"t"},{"first_character":"n","occurrence_count":0.52,"second_character":"u"},{"first_character":"n","occurrence_count":0.3,"second_character":"v"},{"first_character":"n","occurrence_count":0.06,"second_character":"w"},{"first_character":"n","occurrence_count":0.03,"second_character":"x"},{"first_character":"n","occurrence_count":2.54,"second_character":"y"},{"first_character":"n","occurrence_count":0.79,"second_character":"z"},{"first_character":"o","occurrence_count":10.78,"second_character":"."},{"first_character":"o","occurrence_count":1.88,"second_character":"a"},{"first_character":"o","occurrence_count":1.76,"second_character":"b"},{"first_character":"o","occurrence_count":1.44,"second_character":"c"},{"first_character":"o","occurrence_count":2.39,"second_character":"d"},{"first_character":"o","occurrence_count":1.66,"second_character":"e"},{"first_character":"o","occurrence_count":0.43,"second_character":"f"},{"first_character":"o","occurrence_count":0.55,"second_character":"g"},{"first_character":"o","occurrence_count":2.16,"second_character":"h"},{"first_character":"o","occurrence_count":0.87,"second_character":"i"},{"first_character":"o","occurrence_count":0.2,"second_character":"j"},{"first_character":"o","occurrence_count":0.86,"second_character":"k"},{"first_character":"o","occurrence_count":7.8,"second_character":"l"},{"first_character":"o","occurrence_count":3.29,"second_character":"m"},{"first_character":"o","occurrence_count":30.39,"second_character":"n"},{"first_character":"o","occurrence_count":1.45,"second_character":"o"},{"first_character":"o","occurrence_count":1.2,"second_character":"p"},{"first_character":"o","occurrence_count":0.04,"second_character":"q"},{"first_character":"o","occurrence_count":13.35,"second_character":"r"},{"first_character":"o","occurrence_count":6.35,"second_character":"s"},{"first_character":"o","occurrence_count":1.49,"second_character":"t"},{"first_character":"o","occurrence_count":3.47,"second_character":"u"},{"first_character":"o","occurrence_count":2.22,"second_character":"v"},{"first_character":"o","occurrence_count":1.44,"second_character":"w"},{"first_character":"o","occurrence_count":0.57,"second_character":"x"},{"first_character":"o","occurrence_count":1.3,"second_character":"y"},{"first_character":"o","occurrence_count":0.68,"second_character":"z"},{"first_character":"p","occurrence_count":3.22,"second_character":"."},{"first_character":"p","occurrence_count":20.37,"second_character":"a"},{"first_character":"p","occurrence_count":0.19,"second_character":"b"},{"first_character":"p","occurrence_count":0.1,"second_character":"c"},{"first_character":"p","occurrence_count":0.0,"second_character":"d"},{"first_character":"p","occurrence_count":19.2,"second_character":"e"},{"first_character":"p","occurrence_count":0.1,"second_character":"f"},{"first_character":"p","occurrence_count":0.0,"second_character":"g"},{"first_character":"p","occurrence_count":19.88,"second_character":"h"},{"first_character":"p","occurrence_count":5.95,"second_character":"i"},{"first_character":"p","occurrence_count":0.1,"second_character":"j"},{"first_character":"p","occurrence_count":0.1,"second_character":"k"},{"first_character":"p","occurrence_count":1.56,"second_character":"l"},{"first_character":"p","occurrence_count":0.1,"second_character":"m"},{"first_character":"p","occurrence_count":0.1,"second_character":"n"},{"first_character":"p","occurrence_count":5.75,"second_character":"o"},{"first_character":"p","occurrence_count":3.8,"second_character":"p"},{"first_character":"p","occurrence_count":0.0,"second_character":"q"},{"first_character":"p","occurrence_count":14.72,"second_character":"r"},{"first_character":"p","occurrence_count":1.56,"second_character":"s"},{"first_character":"p","occurrence_count":1.66,"second_character":"t"},{"first_character":"p","occurrence_count":0.39,"second_character":"u"},{"first_character":"p","occurrence_count":0.0,"second_character":"v"},{"first_character":"p","occurrence_count":0.0,"second_character":"w"},{"first_character":"p","occurrence_count":0.0,"second_character":"x"},{"first_character":"p","occurrence_count":1.17,"second_character":"y"},{"first_character":"p","occurrence_count":0.0,"second_character":"z"},{"first_character":"q","occurrence_count":10.29,"second_character":"."},{"first_character":"q","occurrence_count":4.78,"second_character":"a"},{"first_character":"q","occurrence_count":0.0,"second_character":"b"},{"first_character":"q","occurrence_count":0.0,"second_character":"c"},{"first_character":"q","occurrence_count":0.0,"second_character":"d"},{"first_character":"q","occurrence_count":0.37,"second_character":"e"},{"first_character":"q","occurrence_count":0.0,"second_character":"f"},{"first_character":"q","occurrence_count":0.0,"second_character":"g"},{"first_character":"q","occurrence_count":0.0,"second_character":"h"},{"first_character":"q","occurrence_count":4.78,"second_character":"i"},{"first_character":"q","occurrence_count":0.0,"second_character":"j"},{"first_character":"q","occurrence_count":0.0,"second_character":"k"},{"first_character":"q","occurrence_count":0.37,"second_character":"l"},{"first_character":"q","occurrence_count":0.74,"second_character":"m"},{"first_character":"q","occurrence_count":0.0,"second_character":"n"},{"first_character":"q","occurrence_count":0.74,"second_character":"o"},{"first_character":"q","occurrence_count":0.0,"second_character":"p"},{"first_character":"q","occurrence_count":0.0,"second_character":"q"},{"first_character":"q","occurrence_count":0.37,"second_character":"r"},{"first_character":"q","occurrence_count":0.74,"second_character":"s"},{"first_character":"q","occurrence_count":0.0,"second_character":"t"},{"first_character":"q","occurrence_count":75.74,"second_character":"u"},{"first_character":"q","occurrence_count":0.0,"second_character":"v"},{"first_character":"q","occurrence_count":1.1,"second_character":"w"},{"first_character":"q","occurrence_count":0.0,"second_character":"x"},{"first_character":"q","occurrence_count":0.0,"second_character":"y"},{"first_character":"q","occurrence_count":0.0,"second_character":"z"},{"first_character":"r","occurrence_count":10.84,"second_character":"."},{"first_character":"r","occurrence_count":18.55,"second_character":"a"},{"first_character":"r","occurrence_count":0.32,"second_character":"b"},{"first_character":"r","occurrence_count":0.78,"second_character":"c"},{"first_character":"r","occurrence_count":1.47,"second_character":"d"},{"first_character":"r","occurrence_count":13.36,"second_character":"e"},{"first_character":"r","occurrence_count":0.07,"second_character":"f"},{"first_character":"r","occurrence_count":0.6,"second_character":"g"},{"first_character":"r","occurrence_count":0.95,"second_character":"h"},{"first_character":"r","occurrence_count":23.88,"second_character":"i"},{"first_character":"r","occurrence_count":0.2,"second_character":"j"},{"first_character":"r","occurrence_count":0.71,"second_character":"k"},{"first_character":"r","occurrence_count":3.25,"second_character":"l"},{"first_character":"r","occurrence_count":1.28,"second_character":"m"},{"first_character":"r","occurrence_count":1.1,"second_character":"n"},{"first_character":"r","occurrence_count":6.84,"second_character":"o"},{"first_character":"r","occurrence_count":0.11,"second_character":"p"},{"first_character":"r","occurrence_count":0.13,"second_character":"q"},{"first_character":"r","occurrence_count":3.35,"second_character":"r"},{"first_character":"r","occurrence_count":1.5,"second_character":"s"},{"first_character":"r","occurrence_count":1.64,"second_character":"t"},{"first_character":"r","occurrence_count":1.98,"second_character":"u"},{"first_character":"r","occurrence_count":0.63,"second_character":"v"},{"first_character":"r","occurrence_count":0.17,"second_character":"w"},{"first_character":"r","occurrence_count":0.02,"second_character":"x"},{"first_character":"r","occurrence_count":6.09,"second_character":"y"},{"first_character":"r","occurrence_count":0.18,"second_character":"z"},{"first_character":"s","occurrence_count":14.42,"second_character":"."},{"first_character":"s","occurrence_count":14.82,"second_character":"a"},{"first_character":"s","occurrence_count":0.26,"second_character":"b"},{"first_character":"s","occurrence_count":0.74,"second_character":"c"},{"first_character":"s","occurrence_count":0.11,"second_character":"d"},{"first_character":"s","occurrence_count":10.91,"second_character":"e"},{"first_character":"s","occurrence_count":0.02,"second_character":"f"},{"first_character":"s","occurrence_count":0.02,"second_character":"g"},{"first_character":"s","occurrence_count":15.85,"second_character":"h"},{"first_character":"s","occurrence_count":8.44,"second_character":"i"},{"first_character":"s","occurrence_count":0.02,"second_character":"j"},{"first_character":"s","occurrence_count":1.01,"second_character":"k"},{"first_character":"s","occurrence_count":3.44,"second_character":"l"},{"first_character":"s","occurrence_count":1.11,"second_character":"m"},{"first_character":"s","occurrence_count":0.3,"second_character":"n"},{"first_character":"s","occurrence_count":6.55,"second_character":"o"},{"first_character":"s","occurrence_count":0.63,"second_character":"p"},{"first_character":"s","occurrence_count":0.01,"second_character":"q"},{"first_character":"s","occurrence_count":0.68,"second_character":"r"},{"first_character":"s","occurrence_count":5.69,"second_character":"s"},{"first_character":"s","occurrence_count":9.44,"second_character":"t"},{"first_character":"s","occurrence_count":2.28,"second_character":"u"},{"first_character":"s","occurrence_count":0.17,"second_character":"v"},{"first_character":"s","occurrence_count":0.3,"second_character":"w"},{"first_character":"s","occurrence_count":0.0,"second_character":"x"},{"first_character":"s","occurrence_count":2.65,"second_character":"y"},{"first_character":"s","occurrence_count":0.12,"second_character":"z"},{"first_character":"t","occurrence_count":8.67,"second_character":"."},{"first_character":"t","occurrence_count":18.44,"second_character":"a"},{"first_character":"t","occurrence_count":0.02,"second_character":"b"},{"first_character":"t","occurrence_count":0.31,"second_character":"c"},{"first_character":"t","occurrence_count":0.0,"second_character":"d"},{"first_character":"t","occurrence_count":12.85,"second_character":"e"},{"first_character":"t","occurrence_count":0.04,"second_character":"f"},{"first_character":"t","occurrence_count":0.04,"second_character":"g"},{"first_character":"t","occurrence_count":11.62,"second_character":"h"},{"first_character":"t","occurrence_count":9.55,"second_character":"i"},{"first_character":"t","occurrence_count":0.05,"second_character":"j"},{"first_character":"t","occurrence_count":0.0,"second_character":"k"},{"first_character":"t","occurrence_count":2.41,"second_character":"l"},{"first_character":"t","occurrence_count":0.07,"second_character":"m"},{"first_character":"t","occurrence_count":0.39,"second_character":"n"},{"first_character":"t","occurrence_count":11.97,"second_character":"o"},{"first_character":"t","occurrence_count":0.0,"second_character":"p"},{"first_character":"t","occurrence_count":0.0,"second_character":"q"},{"first_character":"t","occurrence_count":6.32,"second_character":"r"},{"first_character":"t","occurrence_count":0.63,"second_character":"s"},{"first_character":"t","occurrence_count":6.71,"second_character":"t"},{"first_character":"t","occurrence_count":1.4,"second_character":"u"},{"first_character":"t","occurrence_count":0.27,"second_character":"v"},{"first_character":"t","occurrence_count":0.2,"second_character":"w"},{"first_character":"t","occurrence_count":0.04,"second_character":"x"},{"first_character":"t","occurrence_count":6.12,"second_character":"y"},{"first_character":"t","occurrence_count":1.89,"second_character":"z"},{"first_character":"u","occurrence_count":4.94,"second_character":"."},{"first_character":"u","occurrence_count":5.2,"second_character":"a"},{"first_character":"u","occurrence_count":3.29,"second_character":"b"},{"first_character":"u","occurrence_count":3.29,"second_character":"c"},{"first_character":"u","occurrence_count":4.34,"second_character":"d"},{"first_character":"u","occurrence_count":5.39,"second_character":"e"},{"first_character":"u","occurrence_count":0.61,"second_character":"f"},{"first_character":"u","occurrence_count":1.5,"second_character":"g"},{"first_character":"u","occurrence_count":1.85,"second_character":"h"},{"first_character":"u","occurrence_count":3.86,"second_character":"i"},{"first_character":"u","occurrence_count":0.45,"second_character":"j"},{"first_character":"u","occurrence_count":2.97,"second_character":"k"},{"first_character":"u","occurrence_count":9.6,"second_character":"l"},{"first_character":"u","occurrence_count":4.91,"second_character":"m"},{"first_character":"u","occurrence_count":8.77,"second_character":"n"},{"first_character":"u","occurrence_count":0.32,"second_character":"o"},{"first_character":"u","occurrence_count":0.51,"second_character":"p"},{"first_character":"u","occurrence_count":0.32,"second_character":"q"},{"first_character":"u","occurrence_count":13.21,"second_character":"r"},{"first_character":"u","occurrence_count":15.12,"second_character":"s"},{"first_character":"u","occurrence_count":2.62,"second_character":"t"},{"first_character":"u","occurrence_count":0.1,"second_character":"u"},{"first_character":"u","occurrence_count":1.18,"second_character":"v"},{"first_character":"u","occurrence_count":2.74,"second_character":"w"},{"first_character":"u","occurrence_count":1.08,"second_character":"x"},{"first_character":"u","occurrence_count":0.41,"second_character":"y"},{"first_character":"u","occurrence_count":1.44,"second_character":"z"},{"first_character":"v","occurrence_count":3.42,"second_character":"."},{"first_character":"v","occurrence_count":24.95,"second_character":"a"},{"first_character":"v","occurrence_count":0.04,"second_character":"b"},{"first_character":"v","occurrence_count":0.0,"second_character":"c"},{"first_character":"v","occurrence_count":0.04,"second_character":"d"},{"first_character":"v","occurrence_count":22.08,"second_character":"e"},{"first_character":"v","occurrence_count":0.0,"second_character":"f"},{"first_character":"v","occurrence_count":0.0,"second_character":"g"},{"first_character":"v","occurrence_count":0.04,"second_character":"h"},{"first_character":"v","occurrence_count":35.41,"second_character":"i"},{"first_character":"v","occurrence_count":0.0,"second_character":"j"},{"first_character":"v","occurrence_count":0.12,"second_character":"k"},{"first_character":"v","occurrence_count":0.54,"second_character":"l"},{"first_character":"v","occurrence_count":0.0,"second_character":"m"},{"first_character":"v","occurrence_count":0.31,"second_character":"n"},{"first_character":"v","occurrence_count":5.95,"second_character":"o"},{"first_character":"v","occurrence_count":0.0,"second_character":"p"},{"first_character":"v","occurrence_count":0.0,"second_character":"q"},{"first_character":"v","occurrence_count":1.87,"second_character":"r"},{"first_character":"v","occurrence_count":0.0,"second_character":"s"},{"first_character":"v","occurrence_count":0.0,"second_character":"t"},{"first_character":"v","occurrence_count":0.27,"second_character":"u"},{"first_character":"v","occurrence_count":0.27,"second_character":"v"},{"first_character":"v","occurrence_count":0.0,"second_character":"w"},{"first_character":"v","occurrence_count":0.0,"second_character":"x"},{"first_character":"v","occurrence_count":4.7,"second_character":"y"},{"first_character":"v","occurrence_count":0.0,"second_character":"z"},{"first_character":"w","occurrence_count":5.49,"second_character":"."},{"first_character":"w","occurrence_count":30.14,"second_character":"a"},{"first_character":"w","occurrence_count":0.11,"second_character":"b"},{"first_character":"w","occurrence_count":0.0,"second_character":"c"},{"first_character":"w","occurrence_count":0.86,"second_character":"d"},{"first_character":"w","occurrence_count":16.04,"second_character":"e"},{"first_character":"w","occurrence_count":0.22,"second_character":"f"},{"first_character":"w","occurrence_count":0.11,"second_character":"g"},{"first_character":"w","occurrence_count":2.48,"second_character":"h"},{"first_character":"w","occurrence_count":15.93,"second_character":"i"},{"first_character":"w","occurrence_count":0.0,"second_character":"j"},{"first_character":"w","occurrence_count":0.65,"second_character":"k"},{"first_character":"w","occurrence_count":1.4,"second_character":"l"},{"first_character":"w","occurrence_count":0.22,"second_character":"m"},{"first_character":"w","occurrence_count":6.24,"second_character":"n"},{"first_character":"w","occurrence_count":3.88,"second_character":"o"},{"first_character":"w","occurrence_count":0.0,"second_character":"p"},{"first_character":"w","occurrence_count":0.0,"second_character":"q"},{"first_character":"w","occurrence_count":2.37,"second_character":"r"},{"first_character":"w","occurrence_count":2.15,"second_character":"s"},{"first_character":"w","occurrence_count":0.86,"second_character":"t"},{"first_character":"w","occurrence_count":2.69,"second_character":"u"},{"first_character":"w","occurrence_count":0.0,"second_character":"v"},{"first_character":"w","occurrence_count":0.22,"second_character":"w"},{"first_character":"w","occurrence_count":0.0,"second_character":"x"},{"first_character":"w","occurrence_count":7.86,"second_character":"y"},{"first_character":"w","occurrence_count":0.11,"second_character":"z"},{"first_character":"x","occurrence_count":23.53,"second_character":"."},{"first_character":"x","occurrence_count":14.78,"second_character":"a"},{"first_character":"x","occurrence_count":0.14,"second_character":"b"},{"first_character":"x","occurrence_count":0.57,"second_character":"c"},{"first_character":"x","occurrence_count":0.72,"second_character":"d"},{"first_character":"x","occurrence_count":5.16,"second_character":"e"},{"first_character":"x","occurrence_count":0.43,"second_character":"f"},{"first_character":"x","occurrence_count":0.0,"second_character":"g"},{"first_character":"x","occurrence_count":0.14,"second_character":"h"},{"first_character":"x","occurrence_count":14.63,"second_character":"i"},{"first_character":"x","occurrence_count":0.0,"second_character":"j"},{"first_character":"x","occurrence_count":0.0,"second_character":"k"},{"first_character":"x","occurrence_count":5.6,"second_character":"l"},{"first_character":"x","occurrence_count":0.14,"second_character":"m"},{"first_character":"x","occurrence_count":0.14,"second_character":"n"},{"first_character":"x","occurrence_count":5.88,"second_character":"o"},{"first_character":"x","occurrence_count":0.0,"second_character":"p"},{"first_character":"x","occurrence_count":0.0,"second_character":"q"},{"first_character":"x","occurrence_count":0.0,"second_character":"r"},{"first_character":"x","occurrence_count":4.45,"second_character":"s"},{"first_character":"x","occurrence_count":10.04,"second_character":"t"},{"first_character":"x","occurrence_count":0.72,"second_character":"u"},{"first_character":"x","occurrence_count":0.0,"second_character":"v"},{"first_character":"x","occurrence_count":0.43,"second_character":"w"},{"first_character":"x","occurrence_count":5.45,"second_character":"x"},{"first_character":"x","occurrence_count":4.3,"second_character":"y"},{"first_character":"x","occurrence_count":2.73,"second_character":"z"},{"first_character":"y","occurrence_count":20.53,"second_character":"."},{"first_character":"y","occurrence_count":21.92,"second_character":"a"},{"first_character":"y","occurrence_count":0.28,"second_character":"b"},{"first_character":"y","occurrence_count":1.18,"second_character":"c"},{"first_character":"y","occurrence_count":2.78,"second_character":"d"},{"first_character":"y","occurrence_count":3.08,"second_character":"e"},{"first_character":"y","occurrence_count":0.12,"second_character":"f"},{"first_character":"y","occurrence_count":0.31,"second_character":"g"},{"first_character":"y","occurrence_count":0.23,"second_character":"h"},{"first_character":"y","occurrence_count":1.96,"second_character":"i"},{"first_character":"y","occurrence_count":0.24,"second_character":"j"},{"first_character":"y","occurrence_count":0.88,"second_character":"k"},{"first_character":"y","occurrence_count":11.29,"second_character":"l"},{"first_character":"y","occurrence_count":1.51,"second_character":"m"},{"first_character":"y","occurrence_count":18.68,"second_character":"n"},{"first_character":"y","occurrence_count":2.77,"second_character":"o"},{"first_character":"y","occurrence_count":0.15,"second_character":"p"},{"first_character":"y","occurrence_count":0.06,"second_character":"q"},{"first_character":"y","occurrence_count":2.98,"second_character":"r"},{"first_character":"y","occurrence_count":4.1,"second_character":"s"},{"first_character":"y","occurrence_count":1.06,"second_character":"t"},{"first_character":"y","occurrence_count":1.44,"second_character":"u"},{"first_character":"y","occurrence_count":1.08,"second_character":"v"},{"first_character":"y","occurrence_count":0.04,"second_character":"w"},{"first_character":"y","occurrence_count":0.29,"second_character":"x"},{"first_character":"y","occurrence_count":0.24,"second_character":"y"},{"first_character":"y","occurrence_count":0.8,"second_character":"z"},{"first_character":"z","occurrence_count":6.67,"second_character":"."},{"first_character":"z","occurrence_count":35.86,"second_character":"a"},{"first_character":"z","occurrence_count":0.17,"second_character":"b"},{"first_character":"z","occurrence_count":0.08,"second_character":"c"},{"first_character":"z","occurrence_count":0.08,"second_character":"d"},{"first_character":"z","occurrence_count":15.55,"second_character":"e"},{"first_character":"z","occurrence_count":0.0,"second_character":"f"},{"first_character":"z","occurrence_count":0.04,"second_character":"g"},{"first_character":"z","occurrence_count":1.79,"second_character":"h"},{"first_character":"z","occurrence_count":15.18,"second_character":"i"},{"first_character":"z","occurrence_count":0.08,"second_character":"j"},{"first_character":"z","occurrence_count":0.08,"second_character":"k"},{"first_character":"z","occurrence_count":5.13,"second_character":"l"},{"first_character":"z","occurrence_count":1.46,"second_character":"m"},{"first_character":"z","occurrence_count":0.17,"second_character":"n"},{"first_character":"z","occurrence_count":4.59,"second_character":"o"},{"first_character":"z","occurrence_count":0.08,"second_character":"p"},{"first_character":"z","occurrence_count":0.0,"second_character":"q"},{"first_character":"z","occurrence_count":1.33,"second_character":"r"},{"first_character":"z","occurrence_count":0.17,"second_character":"s"},{"first_character":"z","occurrence_count":0.17,"second_character":"t"},{"first_character":"z","occurrence_count":3.04,"second_character":"u"},{"first_character":"z","occurrence_count":0.08,"second_character":"v"},{"first_character":"z","occurrence_count":0.13,"second_character":"w"},{"first_character":"z","occurrence_count":0.04,"second_character":"x"},{"first_character":"z","occurrence_count":6.13,"second_character":"y"},{"first_character":"z","occurrence_count":1.88,"second_character":"z"}]},"layer":[{"encoding":{"color":{"aggregate":"mean","field":"occurrence_count","legend":false,"type":"quantitative"},"x":{"axis":{"labelAngle":0,"orient":"top"},"field":"second_character","type":"nominal"},"y":{"field":"first_character","type":"nominal"}},"mark":{"fillOpacity":1,"tooltip":true,"type":"rect"}},{"encoding":{"text":{"aggregate":"mean","field":"occurrence_count","type":"quantitative"},"x":{"axis":{"labelAngle":0,"orient":"top"},"field":"second_character","type":"nominal"},"y":{"field":"first_character","type":"nominal"}},"mark":"text"}],"width":850}
```

We read the heatmap along each row seeing the probability of each character being the next. We can see that there is a near 30% that `h` is the final letter, or followed by an `a`. Or that 75% of the time we have a `q` then next character will be `u`.

We can create a simple recursive model that samples the next character until we reach the end character `.`

The main function in the model is `Nx.Random.choice/3` which takes in the current key (used in the pseudo-random number generator), the a list of possible indexes as a tensor and the probability matrix.

As an example if we wanted to randomly select either `0` or `1` when the probability of `0` is 90% and the probability of `1` is 10% we could call `choice/3` like this:

```elixir
for i <- 1..10 do
  {res, _key} = Nx.Random.choice(Nx.Random.key(i), Nx.tensor([0, 1]), Nx.tensor([0.9, 0.1]))
  Nx.to_number(res[0])
end
```

<!-- livebook:{"output":true} -->

```
[0, 0, 0, 0, 0, 0, 1, 0, 0, 0]
```

As we can see `0` appears 9 times and `1` only the once.

The recursive model then just handles mapping the selected index to the character and calling the function again until `.` is selected and the built string is returned.

```elixir
defmodule SimpleProbabilityModel do
  def sample(0, acc, _, _) when acc != "", do: acc

  def sample(i, acc, probs, key) do
    {char_index, key} = Nx.Random.choice(key, Nx.tensor(Enum.to_list(0..26)), probs[i])

    char_index = Nx.to_number(char_index[0])
    acc = acc <> BigramMapping.int_to_str(char_index)

    sample(char_index, acc, probs, key)
  end
end
```

<!-- livebook:{"output":true} -->

```
{:module, SimpleProbabilityModel, <<70, 79, 82, 49, 0, 0, 11, ...>>, {:sample, 4}}
```

Running the model ten times with differen random seed shows some nonsensical names that at somewhat look like the shape of real names.

```elixir
simple_prob_model_names =
  for i <- 0..10 do
    SimpleProbabilityModel.sample(
      0,
      "",
      bigram_matrix_probabilites,
      Nx.Random.key(i)
    )
    |> String.trim_trailing(".")
  end
```

<!-- livebook:{"output":true} -->

```
["toler", "stlatabr", "kalliarai", "karilide", "ck", "beena", "sariy", "u", "kiylieleoare",
 "ltlamristuta", "ce"]
```

We can show that the bigram model is at least doing better than random by passing in a uniform distribution where every character has an equal chance of being the next character. As we can see it looks like a completely random mess compared to the bigram model.

```elixir
for i <- 0..15 do
  SimpleProbabilityModel.sample(
    0,
    "",
    Nx.broadcast(1, {27, 27}) |> Nx.divide(27),
    Nx.Random.key(i)
  )
  |> String.trim_trailing(".")
end
```

<!-- livebook:{"output":true} -->

```
["xshktbdtszza", "wwpfwceq", "ojlsofsgjcuuiuclmraoixvelenfrmrtqqlufpeptrrzoqmifebrl",
 "nduqmqhkcgpjqshjyithbmza", "es", "cehrl", "vftrzclkg", "y",
 "nsyprklkscuicjajheakwaskndxfbznxpojhfmyixkofgpjwdgyitjmmrxyi",
 "pvpcnxpvwxxedadsueyiwjtumppdazhfo",
 "ekebyzkdpvhmxhecebjleajmrgusrtmegvczlxoumljumfhokczrxhzdgcpdkunqiduskipape",
 "ljyvoguderarvajtwswfubfbxihnswwdvbfzzmiqufuto", "f", "taqmlooldbcltkpauxckxrtzzzxxffgcussmndfcbd",
 "aefdpyrsa", "kmllcsgqleeslum"]
```

## Loss function

A loss function is required to provide a numerical score for how well the model has performed based on the probabilities we've calculated from the training set.

Log likelihood is commonly used to in cases such as this. It takes the `log` of the probabiliy of each bigram in the produced output, sums the result and normalised by dividing by the number of bigrams.

It's called negative log likelihood as positive number is more commonly used to minimise when training more complicated models.

```elixir
defmodule SimpleProbabilityLoss do
  def negative_log_likelihood(names, bigram_probabilities) do
    bigrams = 
      Enum.flat_map(names, &Bigram.from_string/1)
      |> Enum.map(&BigramMapping.encode/1)

    Nx.gather(bigram_probabilities, Nx.tensor(bigrams))
    |> Nx.log()
    |> Nx.sum()
    |> Nx.divide(length(bigrams))
    |> Nx.abs()
  end
end

SimpleProbabilityLoss.negative_log_likelihood(simple_prob_model_names, bigram_matrix_probabilites)
```

<!-- livebook:{"output":true} -->

```
#Nx.Tensor<
  f32
  EXLA.Backend<host:0, 0.1565027411.2003435536.251285>
  2.461193561553955
>
```

## Model smoothing

There is an issue with the model right now, if a value is passed with a bigram that has never been seen (e.g. `mq`) then the loss function will return `Inf`.

```elixir
SimpleProbabilityLoss.negative_log_likelihood(["samq"], bigram_matrix_probabilites)
```

<!-- livebook:{"output":true} -->

```
#Nx.Tensor<
  f32
  EXLA.Backend<host:0, 0.1565027411.2003435536.251293>
  Inf
>
```

To fix this add 1 to each count to avoid any individual count being equal to
zero.

This is called model smoothing which helps makes the model more
uniform. Adding one helps reduce the impact of zeros, but in theory
you could add 1 million which would make every option practically 
equally as likely.

```elixir
bigram_matrix = Nx.add(bigram_matrix, 1)

bigram_matrix_probabilites =
  Nx.divide(
    bigram_matrix,
    Nx.sum(bigram_matrix, axes: [1], keep_axes: true)
  )
```

<!-- livebook:{"output":true} -->

```
#Nx.Tensor<
  f32[27][27]
  EXLA.Backend<host:0, 0.1565027411.2003435536.251297>
  [
    [3.119151733699255e-5, 0.13758577406406403, 0.04076731204986572, 0.048128508031368256, 0.05274485424160957, 0.047785401344299316, 0.01303805410861969, 0.02089831605553627, 0.02729257568717003, 0.018465377390384674, 0.07557704299688339, 0.09245165437459946, 0.04906425625085831, 0.07919526100158691, 0.035776667296886444, 0.01232064887881279, 0.01609482243657112, 0.0029008109122514725, 0.051154084503650665, 0.06412975490093231, 0.040829695761203766, 0.0024641298223286867, 0.011759201064705849, 0.009606987237930298, 0.004210854414850473, 0.016718652099370956, 0.029008109122514725],
    [0.19583038985729218, 0.016424864530563354, 0.01598254218697548, 0.013888888992369175, 0.03075607493519783, 0.020435243844985962, 0.003980891779065132, 0.004983486607670784, 0.06879570335149765, 0.04868483170866966, 0.005189903080463409, 0.016778720542788506, 0.07457537204027176, 0.04821302369236946, 0.16038569808006287, 0.0018872375367209315, 0.002447511302307248, 0.0017987733008340001, 0.0962786003947258, 0.032997168600559235, 0.020287804305553436, 0.01126444898545742, 0.02462255209684372, ...],
    ...
  ]
>
```

```elixir
SimpleProbabilityLoss.negative_log_likelihood(["samq"], bigram_matrix_probabilites)
```

<!-- livebook:{"output":true} -->

```
#Nx.Tensor<
  f32
  EXLA.Backend<host:0, 0.1565027411.2003435536.251302>
  3.765857696533203
>
```

## Simple neural network approach

A neural network can be used to approximate the same model by passing in the first character and returning a set of probabilites for the character that should follow.

```elixir
names_to_input_output_bigrams = fn names ->
  bigrams =
    names
    |> Enum.flat_map(&Bigram.from_string/1)
    |> Enum.map(&BigramMapping.encode/1)
    |> Nx.tensor()

  {bigrams[[.., 0]], bigrams[[.., 1]]}
end

{inputs, outputs} = 
  names_to_input_output_bigrams.(["sam"])
```

<!-- livebook:{"output":true} -->

```
{#Nx.Tensor<
   s32[4]
   EXLA.Backend<host:0, 0.1565027411.2003435536.251306>
   [0, 19, 1, 13]
 >,
 #Nx.Tensor<
   s32[4]
   EXLA.Backend<host:0, 0.1565027411.2003435536.251309>
   [19, 1, 13, 0]
 >}
```

Passing a single integer to the network which will be multipled by various weights doesn't work as well as passing in a one-hot-encoding vector which is set to `1` at the index of the charater while the rest remain zero. So if the vocabulary was only `a, b, c` which mapped to `0, 1, 2`, the one hot encoding for `a` would be `[1, 0, 0]`, and `b` would be `[0, 1, 0]`

```elixir
one_hot_encode = fn tensor ->
  tensor
  |> Nx.new_axis(-1)
  |> Nx.equal(Nx.iota({vocabulary_size}))
end

inputs = one_hot_encode.(inputs)
```

<!-- livebook:{"output":true} -->

```
#Nx.Tensor<
  u8[4][27]
  EXLA.Backend<host:0, 0.1565027411.2003435536.251315>
  [
    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, ...],
    ...
  ]
>
```

For this simple neural network there will only be weights with no bias or activation function. A single layer of 27 neurons with each taking 27 inputs requires and tensor with the shape `{27, 27}`.

```elixir
key = Nx.Random.key(42)

{weights, key} = Nx.Random.normal(key, shape: {27, 27})

weights
```

<!-- livebook:{"output":true} -->

```
#Nx.Tensor<
  f32[27][27]
  EXLA.Backend<host:0, 0.1565027411.2003435536.251840>
  [
    [-1.3813380002975464, 1.1619457006454468, 0.4389880895614624, 0.47841933369636536, -0.01944045163691044, 0.7200543880462646, -1.2873157262802124, 1.8024386167526245, -0.6541416645050049, 2.333552598953247, 0.008432986214756966, 1.7843825817108154, -1.331638216972351, 0.37328076362609863, 1.0773977041244507, -0.050300661474466324, -0.5105248689651489, 0.6116188168525696, 0.9199008941650391, -0.2440028339624405, 0.042304638773202896, 0.3097541928291321, -0.5302157998085022, 0.32695192098617554, -1.0410704612731934, -0.9639928340911865, 0.3592979907989502],
    [1.683728814125061, -0.024233371019363403, -0.516905665397644, 1.0823928117752075, -0.5861626267433167, 1.0994369983673096, -0.647191047668457, 0.37540796399116516, -0.4925920367240906, -1.3620562553405762, -0.4493446946144104, -1.504736065864563, 0.6882826685905457, 0.3561391234397888, 1.356558084487915, 0.15918461978435516, 0.09364021569490433, 1.0270025730133057, -2.107351064682007, 1.587530255317688, -1.3589147329330444, 0.7119573950767517, 3.3185901641845703, ...],
    ...
  ]
>
```

Taking the dot product of the inputs by the weights returns the activations of each neuron in the layer. These values cannot currently be used as a probability distribution since some values are negative and have different ranges.

To solve this the logits (result from the dot product) is exponentiated to remove the negatives, then the values are normalised so each of the rows sum to 1. Note: This is also known as softmax, which produces an output that has only positive values and sums to 1.

```elixir
logits = Nx.dot(inputs, weights)
counts = Nx.exp(logits)

untrained_network_probabilites =
  Nx.divide(
    counts,
    Nx.sum(counts, axes: [1], keep_axes: true)
  )
```

<!-- livebook:{"output":true} -->

```
#Nx.Tensor<
  f32[4][27]
  EXLA.Backend<host:0, 0.1565027411.2003435536.251850>
  [
    [0.004861924331635237, 0.06185036897659302, 0.03001689724624157, 0.031224144622683525, 0.01897897571325302, 0.03975862264633179, 0.0053412336856126785, 0.11735587567090988, 0.01006063912063837, 0.1996019035577774, 0.019515426829457283, 0.11525589972734451, 0.005109666381031275, 0.028107965365052223, 0.05683600530028343, 0.018402226269245148, 0.01161442045122385, 0.03567289561033249, 0.048553839325904846, 0.015161653980612755, 0.02018776908516884, 0.026377899572253227, 0.011387959122657776, 0.02683546394109726, 0.006832576356828213, 0.007380042690783739, 0.027717676013708115],
    [0.058093924075365067, 0.0454820916056633, 0.05167889967560768, 0.07422308623790741, 0.011480205692350864, 0.05333520472049713, 0.007877768017351627, 0.023267574608325958, 0.03405758738517761, 0.017352519556879997, 0.05348069593310356, 0.02075742930173874, 0.009526808746159077, 0.15203088521957397, 0.006109711714088917, 0.003009348176419735, 0.052116766571998596, 0.011071586050093174, 0.044853758066892624, 0.02339315600693226, 0.010454589501023293, 0.0041312891989946365, 0.06633784621953964, ...],
    ...
  ]
>
```

The result of passing three names into the untrained network results in a loss of 3.8712. Stepping through what we have done:

Given the name `sam`, which becomes the bigrams `[[., s], [s, a], [a, m], [m, .]]` encoded to `[[0, 19], [19, 1], [1, 13], [13, 0]]`.

These bigrams are then one hot encoded to map an array full of zeros except at the index of the character which is one. The one hot encoded vectors were passed to the neural net (just 27 weights each taking 27 inputs). We then softmax the result of the network to create the probabilites of what characters come next.

So taking the bigram `[s, a]` (i.e `[19, 1]`) for example. By running "sam" through the same process as before we end up with the probabilities for each bigram. `s` as the input is the second row of the probabilities matrix where each number is the probability of that character being the next character. This shows that the actual next character `a` have a `~4.5%` probability according the network.

```elixir
untrained_network_probabilites[1]
```

<!-- livebook:{"output":true} -->

```
#Nx.Tensor<
  f32[27]
  EXLA.Backend<host:0, 0.1565027411.2003435536.251853>
  [0.058093924075365067, 0.0454820916056633, 0.05167889967560768, 0.07422308623790741, 0.011480205692350864, 0.05333520472049713, 0.007877768017351627, 0.023267574608325958, 0.03405758738517761, 0.017352519556879997, 0.05348069593310356, 0.02075742930173874, 0.009526808746159077, 0.15203088521957397, 0.006109711714088917, 0.003009348176419735, 0.052116766571998596, 0.011071586050093174, 0.044853758066892624, 0.02339315600693226, 0.010454589501023293, 0.0041312891989946365, 0.06633784621953964, 0.014337228611111641, 0.08794016391038895, 0.061035700142383575, 0.0025642095133662224]
>
```

Taking the negative log of this gives the loss for this single example of `~3.1`. For reference the final model will have a loss under `1.0` so this is not great, but also expected from a random, untrained model.

```elixir
untrained_network_probabilites[1][1]
|> Nx.log()
|> Nx.abs()
```

<!-- livebook:{"output":true} -->

```
#Nx.Tensor<
  f32
  EXLA.Backend<host:0, 0.1565027411.2003435536.251860>
  3.0904366970062256
>
```

## Neural network loss

There are two problems with the current Loss function:

1. It takes in a list of names as strings, which are then converted to bigrams and encoded. Doing this every time the loss is calculated is inefficient.
2. It expects the probabilities to be in the shape `{27, 27}`, to then lookup the probability by the index of the leading character, then the index of the following character.

The probabilites from the neural network will be 27 values for each input given, so for this one example `{4, 27}`.

The loss function then gathers the networks predicted probability by looking up the index of the following character for each row in the predictions. This means the loss can be calculated for as many examples in one calculation.

```elixir
defmodule Loss do
  def negative_log_likelihood(expected_outputs, probabilities) do
    indicies =
      [Nx.iota(Nx.shape(expected_outputs)), expected_outputs]
      |> Nx.stack(axis: 1)

    Nx.gather(probabilities, indicies)
    |> Nx.log()
    |> Nx.mean()
    |> Nx.abs()
  end

  def negative_log_likelihood({expected_outputs, probabilities}) do
    negative_log_likelihood(expected_outputs, probabilities)
  end
end

Loss.negative_log_likelihood(outputs, untrained_network_probabilites)
```

<!-- livebook:{"output":true} -->

```
#Nx.Tensor<
  f32
  EXLA.Backend<host:0, 0.1565027411.2003435536.251870>
  3.534393072128296
>
```

## Training the network

Bringing all of this together into a single module, a model can be initialised with random weights, used to created the probabilities for a given input (or set of inputs) and a training function to update the weights.

`Nx`, like `PyTorch`, can automatically calculate the gradients for the intermediate values in a function. `Nx.Defn.value_and_grads/2` takes the input tensors to be used in the forward and backwards passes, and a function which accepts these args returning a tuple containing the loss and the gradients of all of the input tensors.

The gradients of the weights are then used to updated the weights in the direction to reduce the loss by a passed in step size.

```elixir
defmodule SimpleNeuralNetwork do
  def init(opts \\ []) do
    seed = Keyword.get(opts, :seed, 42)
    key = Nx.Random.key(seed)
    {weights, _new_key} = Nx.Random.normal(key, shape: {27, 27})

    weights
  end
  
  def predict(inputs, weights) do
    Nx.dot(inputs, weights)
    |> Nx.exp()
    |> then(&Nx.divide(&1, Nx.sum(&1, axes: [1], keep_axes: true)))
  end

  def train_weights(weights, inputs, expected_outputs, opts \\ []) do
    {loss, {weight_grads, _input_grads, _output_grads}} =
      Nx.Defn.value_and_grad({weights, inputs, expected_outputs},
        fn {weights, inputs, outputs} ->
          probabilites = predict(inputs, weights)
          Loss.negative_log_likelihood(outputs, probabilites)
        end
      )

    step_size = Keyword.get(opts, :step_size, 0.1)

    updated_weights =
      weight_grads
      |> Nx.multiply(-step_size)
      |> Nx.add(weights)

    {loss, updated_weights}
  end
end
```

<!-- livebook:{"output":true} -->

```
{:module, SimpleNeuralNetwork, <<70, 79, 82, 49, 0, 0, 16, ...>>, {:train_weights, 4}}
```

```elixir
{inputs, outputs} = 
  names
  |> names_to_input_output_bigrams.()

inputs = one_hot_encode.(inputs)
init_weights = SimpleNeuralNetwork.init(seed: 2)

probabilites = SimpleNeuralNetwork.predict(inputs, init_weights)
initial_loss = Loss.negative_log_likelihood(outputs, probabilites)

IO.write("Initial loss: #{Nx.to_number(initial_loss)}\n")

step_size = 10

trained_weights =
  Enum.reduce(1..100, init_weights, fn i, weights ->
    {loss, updated_weights} =
      SimpleNeuralNetwork.train_weights(weights, inputs, outputs, step_size: 50)

    IO.write("Iteration #{i}: current loss: #{Nx.to_number(loss)}\r")

    updated_weights
  end)

probabilites = SimpleNeuralNetwork.predict(inputs, trained_weights)
initial_loss = Loss.negative_log_likelihood(outputs, probabilites)

IO.write("\nFinal loss: #{Nx.to_number(initial_loss)}\n")
```

<!-- livebook:{"output":true} -->

```
Initial loss: 3.782604694366455
Iteration 100: current loss: 2.4725542068481445
Final loss: 2.4723408222198486
```

<!-- livebook:{"output":true} -->

```
:ok
```

What's interesting is the loss from the simple neural network equals the loss achieved with the simple bigram model based just on counts of the occurances of each bigram. This intuitavely makes sense when looking at the result of the dot product of the inputs and the weights.

Since the inputs are one hot encoded only one of the 27 neurons in the weights will be multipled by 1, while the rest are multipled by zero so effectively cancelled out. This is another way of describing selecting one row from 27, the same as the simple model.

The training then adjusts the weights to approximately match the probabilites from the counts model.

These resulting probabilities can be passed into the sampling model to produce results that appear quite similar to the results from the previous model.

```elixir
simple_prob_model_names =
  for i <- 0..10 do
    SimpleProbabilityModel.sample(
      0,
      "",
      probabilites,
      Nx.Random.key(i)
    )
    |> String.trim_trailing(".")
  end
```

<!-- livebook:{"output":true} -->

```
["trejo", "stras", "kieniapeiarqer", "k", "ci", "baemlaltrlana", "sciiyalja", "u", "knwiiejenareak",
 "lsnaltqstrteb", "ca"]
```
